//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

!function(){"use strict";var t=1;if(!Object.create)var e=function(){};var n=Array.prototype.slice,i={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(t){i.eventHandlers[t.guid][t.type]||(i.eventHandlers[t.guid][t.type]=[]),i.eventHandlers[t.guid][t.type].push({guid:t.guid,handler:t.handler,scope:t.scope,type:t.type})},addEventHandler:function(t,e,n){var r,a={};"string"==typeof t?(r=n||!1,a[t]=e):(r=e||!1,a=t);for(var s in a)for(var u=a[s],o=s.split(" "),l=0,c=o.length;l<c;l++){var d=o[l];i.addEvent.call(this,{guid:this._guid||this._.guid,handler:u,scope:r,type:d})}},addGuid:function(e,n){e._guid&&!n||(e._guid=t++,i.attributes[e._guid]={},i.eventHandlers[e._guid]={})},attr:function(t){return i.attributes[t]},clone:function(t){var e=i.typeOf(t);return"object"===e?i.extend({},t):"array"===e?t.slice(0):void 0},create:function(t){return Object.create?Object.create(t):(e.prototype=t,new e)},createSubclass:function(t,e){function n(){if(!(this instanceof n))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&i.addGuid(this,!0),s.apply(this,arguments)}t=t||{},e=e||!1;var a=t.superclass.prototype,s=t.hasOwnProperty("constructor")?t.constructor:function(){};e&&i.extend(a,r),n.prototype=i.create(a),n.prototype.constructor=n,i.extend(n,{extend:function(){return i.extendThis.apply(this,arguments)},parent:a,proto:function(){return i.extendThis.apply(this.prototype,arguments)},subclass:function(t){return t=t||{},t.superclass=this,i.createSubclass(t)}});for(var u in t)"constructor"!==u&&"superclass"!==u&&(n.prototype[u]=t[u]);return n},emitEvents:function(t,e,r,a){r=r||!1,a=a||this._guid;for(var s=n.call(i.eventHandlers[a][t]),u=0,o=s.length;u<o;u++){var l=i.extend({},s[u]),c=l.scope?l.scope:this;r&&(l.type=r),l.scope=c,l.handler.call(l.scope,e,l)}},extend:function(){for(var t=n.call(arguments),e=t.shift(),i=0,r=t.length;i<r;i++){var a=t[i];for(var s in a)e[s]=a[s]}return e},extendThis:function(){var t=n.call(arguments);return t.unshift(this),i.extend.apply(this,t)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},removeAttribute:function(t,e){e=e||!1;for(var n=i.trim(t).split(" "),r=0,a=n.length;r<a;r++){var s=i.trim(n[r]);s&&(delete i.attr(this._guid)[s],e||(this.emit("change",s),this.emit("change:"+s),this.emit("remove",s),this.emit("remove:"+s)))}},removeEventHandler:function(t,e){var n=i.eventHandlers[this._guid];if(t&&e){if(!(n=n[t]))return;for(var r,a=0,s=n.length;a<s;a++)(r=n[a].handler)&&r===e&&(n.splice(a--,1),s--)}else t?delete n[t]:i.eventHandlers[this._guid]={}},setAttribute:function(t,e,n){n=n||!1;var r=this.has(t),a=i.attr(this._guid)[t];if(e!==a&&(i.attr(this._guid)[t]=e,!n)){this.emit("change",t),this.emit("change:"+t,e);var s={key:t,newValue:e,oldValue:a||null};this.emit("mutate",s),this.emit("mutate:"+t,s);var u=r?"update":"create";this.emit(u,t),this.emit(u+":"+t,e)}},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(t){return null===t||void 0===t?String(t):Object.prototype.toString.call(t).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(t,e,n){var r=this.get(t),a=i.typeOf(r);"object"!==a&&"array"!==a||(r=i.clone(r));var s=e.call(this,r,t);i.setAttribute.call(this,t,s,n||!1)}},r={emit:function(t,e){e=void 0===e?null:e;for(var n=t.split(" "),r=0,a=n.length;r<a;r++){var s=n[r];i.eventHandlers[-1].all&&i.emitEvents.call(this,"all",e,s,-1),i.eventHandlers[-1][s]&&i.emitEvents.call(this,s,e,s,-1),"number"==typeof this._guid&&(i.eventHandlers[this._guid].all&&i.emitEvents.call(this,"all",e,s),i.eventHandlers[this._guid][s]&&i.emitEvents.call(this,s,e))}},off:function(){i.removeEventHandler.apply(this,arguments)},on:function(){i.addEventHandler.apply(this,arguments)}};i.Module=function(){},i.Module.prototype={each:function(t,e){var n=i.attr(this._guid);for(var r in n){var a=n[r];t.call(e||this,a,r)}},extend:function(){return i.extendThis.apply(this,arguments)},filter:function(t){var e=[],n=i.attr(this._guid);for(var r in n)t.call(this,n[r],r)&&e.push(n[r]);return e},get:function(t){if("string"==typeof t)return this.has(t)?i.attr(this._guid)[t]:null;if("function"==typeof t){var e=this.filter(t);return e.length?e[0]:null}},getAll:function(){return i.clone(i.attr(this._guid))},getAllAsArray:function(){var t=[],e=i.attr(this._guid);for(var n in e){var r=e[n];"object"!==i.typeOf(r)||r.id||(r.id=n),t.push(r)}return t},has:function(t){return void 0!==i.attr(this._guid)[t]},map:function(t,e){var n=[];return this.each(function(i,r){n.push(t.call(e||this,i,r))},e||this),n},push:function(t,e){if("array"===i.typeOf(t))for(var n=0,r=t.length;n<r;n++)i.setAttribute.call(this,i.makeUuid(),t[n],e||!1);else i.setAttribute.call(this,i.makeUuid(),t,e||!1);return this},remove:function(t,e){return void 0===t?(i.attributes[this._guid]={},this.emit("change remove")):"function"==typeof t?this.each(function(n,r){t(n)&&i.removeAttribute.call(this,r,e)}):i.removeAttribute.call(this,t,e||!1),this},set:function(t,e,n){if("object"==typeof t)for(var r in t)i.setAttribute.call(this,r,t[r],e||!1);else i.setAttribute.call(this,t,e,n||!1);return this},size:function(){var t=0,e=i.attr(this._guid);for(var n in e)t++;return t},update:function(t,e,n){return"string"==typeof t?i.updateAttribute.call(this,t,e,n||!1):"function"==typeof t&&this.each(function(e,n){i.updateAttribute.call(this,n,t)}),this}};var a={_:i,extend:function(){return i.extendThis.apply(i.Module.prototype,arguments)},mixinEvents:function(t){return t=t||{},i.addGuid(t),i.extend(t,r)},on:function(){i.addEventHandler.apply(this,arguments)},subclass:function(t,e){return e=e||!1,t=t||{},t.superclass=e?function(){}:i.Module,i.createSubclass(t,!e)},version:"0.8.0"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.Stapes=a):"function"==typeof define&&define.amd?define([],function(){return a}):window.Stapes=a}();