/** @license MIT License (c) copyright B Cavalier & J Hann */

!function(e){e(["require","./when"],function(e){function n(e,n,t,o){var i=[e].concat(c(e,[n,t,o]));return r(v.apply(null,i),v.resolve(e))}function r(e,n){var t,o,i,a;return E.call(e,"parent")?e:(w++,t=n&&"id"in n?n.id+"."+w:w,o=e.then,i=h(e),i.id=t,i.parent=n,i.toString=function(){return s("Promise",t)},i.then=function(n,t,u){if(p(n,t,u),"function"==typeof t){var f=i;do{f.handled=!0}while((f=f.parent)&&!f.handled)}return r(o.apply(e,c(i,arguments)),i)},a=function(){console.error(i.toString())},e.then(function(e){return i.toString=function(){return s("Promise",t,"resolved",e)},e},u(i,function(e){throw i.toString=function(){return s("Promise",t,"REJECTED",e)},f("reject",i,e),i.handled||a(),e})),i)}function t(){var e,n,t,o,i,u,c,p,d,y;e=v.defer();try{throw new Error("deferred.then was removed, use deferred.promise.then")}catch(e){n=e}return e.then=function(){a(n)},t="pending",o=m,y=arguments[arguments.length-1],y===P&&(y=++w),p=e.promise.then,e.id=y,e.promise=r(e.promise,e),d=e.promise.always,e.promise.always=l("promise.always","promise.ensure",d,e.promise),e.resolver=h(e.resolver),e.resolver.toString=function(){return s("Resolver",y,t,o)},c=e.resolver.notify,e.notify=e.resolver.notify=function(n){return f("progress",e,n),c(n)},i=e.resolver.resolve,e.resolve=e.resolver.resolve=function(n){return o=n,t="resolving",f("resolve",e,n),i.apply(P,arguments)},u=e.resolver.reject,e.reject=e.resolver.reject=function(e){return o=e,t="REJECTING",u.apply(P,arguments)},e.toString=function(){return s("Deferred",y,t,o)},p(function(e){return t="resolved",e},function(e){return t="REJECTED",v.reject(e)}),e.resolver.id=y,e}function o(e,t){n[e]=function(){return r(t.apply(v,arguments))}}function i(e,n,r){o(e,function(){return r=r||1,"function"!=typeof arguments[r]&&"function"!=typeof arguments[r+1]&&"function"!=typeof arguments[r+2]||b(e+"() onFulfilled, onRejected, and onProgress are deprecated, use returnedPromise.then/otherwise/ensure instead"),n.apply(v,arguments)})}function u(e,r){return function(t){try{return r(t)}catch(r){if(r){var o=n.debug&&n.debug.exceptionsToRethrow||g;r.name in o&&a(r),f("reject",e,r)}throw r}}}function c(e,n){var r,t,o,i;for(t=[],i=0,o=n.length;i<o;i++)t[i]="function"==typeof(r=n[i])?u(e,r):r;return t}function f(e,r,t,o){var i=n.debug;if(i&&"function"==typeof i[e]){if(arguments.length<4&&"reject"==e)try{throw new Error(r.toString())}catch(e){o=e}try{i[e](r,t,o)}catch(e){a(new Error("when.js global debug handler threw: "+String(e)))}}}function s(e,n,r,t){var o="[object "+e+" "+n+"]";return arguments.length>2&&(o+=" "+r,t!==m&&(o+=": "+t)),o}function a(e){j(function(){throw e},0)}function l(e,n,r,t){return function(){return b(new Error(e+" is deprecated, use "+n).stack),r.apply(t,arguments)}}function p(){var e,n,r;for(e=0,n=arguments.length;e<n;e++)r=arguments[e],d(r)||b(new Error("arg "+e+" must be a function, null, or undefined, but was a "+typeof r).stack)}function d(e){return"function"==typeof e||null==e}function y(){}function h(e){return y.prototype=e,e=new y,y.prototype=P,e}var v,w,m,g,E,b,j,P;v=e("./when"),w=0,m={},E=Object.prototype.hasOwnProperty,b="undefined"!=typeof console&&"function"==typeof console.warn?function(e){console.warn(e)}:function(){},j="object"==typeof vertx?function(e,n){return vertx.setTimer(n,e)}:setTimeout,g={RangeError:1,ReferenceError:1,SyntaxError:1,TypeError:1},b("when/debug is deprecated and will be removed. Use when/monitor/console instead"),n.defer=t,n.isPromise=v.isPromise,i("all",v.all),i("any",v.any),i("some",v.some,2);for(var S in v)!v.hasOwnProperty(S)||S in n||o(S,v[S]);return n})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)});