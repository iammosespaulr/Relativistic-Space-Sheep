/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 * @version 2.5.1
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

// Copyright 2013 jQuery Foundation and other contributors

/*! Hammer.JS - v1.0.9 - 2014-03-18
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

/**
 * PhysicsJS v1.0.0-rc1 - 2014-03-23
 * A modular, extendable, and easy-to-use physics engine for javascript
 * http://wellcaffeinated.net/PhysicsJS
 *
 * Copyright (c) 2014 Jasper Palfree <jasper@wellcaffeinated.net>
 * Licensed MIT
 */

/**
 * @license
 * Lo-Dash 2.2.1 (Custom Build) lodash.com/license | Underscore.js 1.5.2 underscorejs.org/LICENSE
 * Build: `lodash modern exports="none" iife="(function(window){%output%;lodash.extend(Physics.util, lodash);}(this));" include="isObject,isFunction,isArray,isPlainObject,uniqueId,uniq,filter,find,each,random,defaults,extend,transform,clone,throttle,bind,sortedIndex,shuffle" --minify --output lib/lodash.js`
 */

/*!
 * Fast indexOf
 * @param  {Array} arr   The array to search
 * @param  {Mixed} value The value to find
 * @return {Number}       The index OR -1
 */

// MIT license

/*!
     * Get test function to test on sub property
     * @param  {Function} fn   The test function
     * @param  {String}   prop The property name to test
     * @return {Function}        The wrapped function
     */

/*!
     * Get an equality test function
     * @param  {Mixed} toMatch The value to match
     * @param  {String} prop    (optional) The property name to test
     * @return {Function}         The test function
     */

/*!
     * Get a NOT equality test function
     * @param  {Mixed} toMatch The value to match
     * @param  {String} prop    (optional) The property name to test
     * @return {Function}         The test function
     */

/*!
     * Get a test function for matching ANY in array
     * @param  {Mixed} toMatch The value array to match
     * @param  {String} prop    (optional) The property name to test
     * @return {Function}         The test function
     */

/*!
     * Get a test function for matching NOT ANY in array
     * @param  {Mixed} toMatch The value array to match
     * @param  {String} prop    (optional) The property name to test
     * @return {Function}         The test function
     */

/*!
     * Get a test function to match any body who's aabb intersects point
     * @param  {Vectorish} point The point to check
     * @return {Function}       The test function
     */

/*!
     * Get an AND test function
     * @param  {Function} first First function node
     * @return {Function}       Test function
     */

/*!
     * Get an OR test function
     * @param  {Function} first First function node
     * @return {function}       Test function
     */

!function(t,e){"use strict";t("when/when",["require"],function(t){function n(t,e,n,r){return i(t).then(e,n,r)}function i(t){return t instanceof r?t:o(t)}function r(t,e){this._message=t,this.inspect=e}function o(t){return c(function(e){e(t)})}function s(t){return n(t,d)}function a(){function t(t,r,s){e.resolve=e.resolver.resolve=function(e){return i?o(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return i?o(d(t)):(i=!0,r(t),n)},e.notify=e.resolver.notify=function(t){return s(t),t}}var e,n,i;return e={promise:U,resolve:U,reject:U,notify:U,resolver:{resolve:U,reject:U,notify:U}},e.promise=n=c(t),e}function c(t){return u(t,X.PromiseStatus&&X.PromiseStatus())}function u(t,e){function n(t,e,n,i){function r(r){r._message(t,e,n,i)}h?h.push(r):B(function(){r(u)})}function i(){return u?u.inspect():M()}function o(t){if(h){var n=h;h=U,B(function(){u=v(c,t),e&&b(u,e),l(n,u)})}}function s(t){o(d(t))}function a(t){if(h){var e=h;B(function(){l(e,p(t))})}}var c,u,h=[];c=new r(n,i),c._status=e;try{t(o,s,a)}catch(t){s(t)}return c}function l(t,e){for(var n=0;n<t.length;n++)t[n](e)}function h(t){return f(new m(t),function(){return S(t)})}function d(t){return f(new y(t),function(){return C(t)})}function f(t,e){return new r(function(e,n,i){try{i(t[e].apply(t,n))}catch(t){i(d(t))}},e)}function p(t){return new r(function(e,n,i,r){var o=n[2];try{r("function"==typeof o?o(t):t)}catch(t){r(t)}})}function v(t,e){if(e===t)return d(new TypeError);if(e instanceof r)return e;try{var n=e===Object(e)&&e.then;return"function"==typeof n?g(n,e):h(e)}catch(t){return d(t)}}function g(t,e){return c(function(n,i){R(t,e,n,i)})}function m(t){this.value=t}function y(t){this.reason=t}function b(t,e){function n(){e.fulfilled()}function i(t){e.rejected(t)}t.then(n,i)}function _(t){return t&&"function"==typeof t.then}function w(t,e,i,r,o){return n(t,function(t){function s(i,r,o){function s(t){f(t)}function a(t){d(t)}var c,u,l,h,d,f,p,v;if(p=t.length>>>0,c=Math.max(0,Math.min(e,p)),l=[],u=p-c+1,h=[],c)for(f=function(t){h.push(t),--u||(d=f=j,r(h))},d=function(t){l.push(t),--c||(d=f=j,i(l))},v=0;v<p;++v)v in t&&n(t[v],a,s,o);else i(l)}return c(s).then(i,r,o)})}function x(t,e,n,i){function r(t){return e?e(t[0]):t[0]}return w(t,1,r,n,i)}function T(t,e,n,i){return P(t,j).then(e,n,i)}function E(){return P(arguments,j)}function k(t){return P(t,S,C)}function I(t,e){return P(t,e)}function P(t,e,i){return n(t,function(t){function r(r,o,s){var a,c,u,l;if(u=c=t.length>>>0,a=[],!u)return void r(a);for(l=0;l<c;l++)l in t?function(t,c){n(t,e,i).then(function(t){a[c]=t,--u||r(a)},o,s)}(t[l],l):--u}return u(r)})}function A(t,e){var i=R(F,arguments,1);return n(t,function(t){var r;return r=t.length,i[0]=function(t,i,o){return n(t,function(t){return n(i,function(n){return e(t,n,o,r)})})},O.apply(t,i)})}function S(t){return{state:"fulfilled",value:t}}function C(t){return{state:"rejected",reason:t}}function M(){return{state:"pending"}}function B(t){1===N.push(t)&&W(D)}function D(){l(N),N=[]}function j(t){return t}n.promise=c,n.resolve=o,n.reject=s,n.defer=a,n.join=E,n.all=T,n.map=I,n.reduce=A,n.settle=k,n.any=x,n.some=w,n.isPromise=_,n.isPromiseLike=_,r.prototype={then:function(t,e,n){var i,r;return i=arguments,r=this._message,u(function(t,e,n){r("when",i,t,n)},this._status&&this._status.observed())},otherwise:function(t){return this.then(U,t)},ensure:function(t){function e(){return o(t())}return"function"==typeof t?this.then(e,e).yield(this):this},yield:function(t){return this.then(function(){return t})},tap:function(t){return this.then(t).yield(this)},spread:function(t){return this.then(function(e){return T(e,function(e){return t.apply(U,e)})})},always:function(t,e){return this.then(t,t,e)}},m.prototype.when=function(t){return"function"==typeof t?t(this.value):this.value},y.prototype.when=function(t,e){if("function"==typeof e)return e(this.reason);throw this.reason};var O,F,R,W,N,L,H,V,q,X,z,Y,U;if(z=t,N=[],L=e.setTimeout,X="undefined"!=typeof console?console:n,"object"==typeof process&&process.nextTick)W=process.nextTick;else if(Y=e.MutationObserver||e.WebKitMutationObserver)W=function(t,e,n){var i=t.createElement("div");return new e(n).observe(i,{attributes:!0}),function(){i.setAttribute("x","x")}}(document,Y,D);else try{W=z("vertx").runOnLoop||z("vertx").runOnContext}catch(t){W=function(t){L(t,0)}}return H=Function.prototype,V=H.call,R=H.bind?V.bind(V):function(t,e){return t.apply(e,F.call(arguments,2))},q=[],F=q.slice,O=q.reduce||function(t){var e,n,i,r,o;if(o=0,e=Object(this),r=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){i=e[o++];break}if(++o>=r)throw new TypeError}else i=n[1];for(;o<r;++o)o in e&&(i=t(i,e[o],o,e));return i},n})}("function"==typeof define&&define.amd?define:function(t){module.exports=t(require)},this),define("when",["when/when"],function(t){return t}),define("plugins/domready",[],function(){"use strict";function t(t){var e;for(e=0;e<t.length;e+=1)t[e](u)}function e(){var e=l;c&&e.length&&(l=[],t(e))}function n(){c||(c=!0,s&&clearInterval(s),e())}function i(t){return c?t(u):l.push(t),i}var r,o,s,a="undefined"!=typeof window&&window.document,c=!a,u=a?document:null,l=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{r=null===window.frameElement}catch(t){}o.doScroll&&r&&window.external&&(s=setInterval(function(){try{o.doScroll(),n()}catch(t){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(t,e,n,r){r.isBuild?n(null):i(n)},i}),define("util/events",["when"],function(t){var e;return e=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){return function(){return t.apply(e,arguments)}},{on:function(t,n,i){var r=this._topics||(this._topics={}),o=r[t]||(r[t]=[]),s=n;if("object"==typeof t){for(var a in t)this.on(a,t[a],n,i);return this}return"object"==typeof i&&(n=e(n,i),n._bindfn_=s),o.push(n),this},off:function(t,e){var n,i=this._topics||(this._topics={}),r=i[t];if(!r)return this;for(var o=0,s=r.length;o<s;o++)if(n=r[o],n._bindfn_===e||n===e){r.splice(o,1);break}return this},emit:function(t,e){var n=this._topics||(this._topics={}),i=n[t],r=i&&i.length,o=0,s={topic:t};if(!r)return this;for(;o<r;)s.handler=i[o],s.handler&&s.handler(s,e),o++;return this},after:function(e,n){var i=this._dfds||(this._dfds={}),r=i[e]||(i[e]=t.defer());return n?r.promise.then(n):r.promise},resolve:function(e,n){var i=this._dfds||(this._dfds={});return(i[e]||(i[e]=t.defer())).resolve(n),this}}}),define("moddef",["util/events"],function(t){var e={}.hasOwnProperty,n={events:t},i=function(t){return"function"==typeof t},r=Array.isArray,o=function(t){if("object"!=typeof t||t.nodeType||t===window)return!1;try{if(t.constructor&&!e.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},s=function t(){var e,n,s,a,c,u,l=arguments[0]||{},h=1,d=arguments.length,f=!1;if("boolean"==typeof l&&(f=l,l=arguments[h]||{},h++),"object"==typeof l||i(l)||(l={}),h===d)return l;for(;h<d;h++)if(null!=(e=arguments[h]))for(n in e)s=l[n],a=e[n],l!==a&&(f&&a&&(o(a)||(c=r(a)))?(c?(c=!1,u=s&&r(s)?s:[]):u=s&&o(s)?s:{},l[n]=t(f,u,a)):void 0!==a&&(l[n]=a));return l};return function(t,e){var i=function t(e){if(!(this instanceof t))return new t(e);this.constructor&&this.constructor(e)};if(i.prototype=t,e)for(var r;r=e.pop();)i.prototype=s(i.prototype,n[r]);return i}}),function(t,e){"use strict";function n(){i.READY||(y.determineEventTypes(),p.each(i.gestures,function(t){_.register(t)}),y.onTouch(i.DOCUMENT,d,_.detect),y.onTouch(i.DOCUMENT,f,_.detect),i.READY=!0)}var i=function(t,e){return new i.Instance(t,e||{})};i.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.HAS_POINTEREVENTS=t.navigator.pointerEnabled||t.navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&t.navigator.userAgent.match(i.MOBILE_REGEX),i.EVENT_TYPES={},i.UPDATE_VELOCITY_INTERVAL=16,i.DOCUMENT=t.document;var r=i.DIRECTION_DOWN="down",o=i.DIRECTION_LEFT="left",s=i.DIRECTION_UP="up",a=i.DIRECTION_RIGHT="right",c=i.POINTER_MOUSE="mouse",u=i.POINTER_TOUCH="touch",l=i.POINTER_PEN="pen",h=i.EVENT_START="start",d=i.EVENT_MOVE="move",f=i.EVENT_END="end";i.plugins=i.plugins||{},i.gestures=i.gestures||{},i.READY=!1;var p=i.utils={extend:function(t,n,i){for(var r in n)t[r]!==e&&i||(t[r]=n[r]);return t},each:function(t,n,i){var r,o;if("forEach"in t)t.forEach(n,i);else if(t.length!==e){for(r=-1;o=t[++r];)if(!1===n.call(i,o,r,t))return}else for(r in t)if(t.hasOwnProperty(r)&&!1===n.call(i,t[r],r,t))return},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],n=[];return p.each(t,function(t){e.push(void 0!==t.clientX?t.clientX:t.pageX),n.push(void 0!==t.clientY?t.clientY:t.pageY)}),{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(t,e,n){return{x:Math.abs(e/t)||0,y:Math.abs(n/t)||0}},getAngle:function(t,e){var n=e.pageY-t.pageY,i=e.pageX-t.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){return Math.abs(t.pageX-e.pageX)>=Math.abs(t.pageY-e.pageY)?t.pageX-e.pageX>0?o:a:t.pageY-e.pageY>0?s:r},getDistance:function(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return Math.sqrt(n*n+i*i)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==s||t==r},toggleDefaultBehavior:function(t,e,n){if(e&&t&&t.style){p.each(["webkit","moz","Moz","ms","o",""],function(i){p.each(e,function(e,r){i&&(r=i+r.substring(0,1).toUpperCase()+r.substring(1)),r in t.style&&(t.style[r]=!n&&e)})});var i=function(){return!1};"none"==e.userSelect&&(t.onselectstart=!n&&i),"none"==e.userDrag&&(t.ondragstart=!n&&i)}}};i.Instance=function(t,e){var r=this;return n(),this.element=t,this.enabled=!0,this.options=p.extend(p.extend({},i.defaults),e||{}),this.options.stop_browser_behavior&&p.toggleDefaultBehavior(this.element,this.options.stop_browser_behavior,!1),this.eventStartHandler=y.onTouch(t,h,function(t){r.enabled&&_.startDetect(r,t)}),this.eventHandlers=[],this},i.Instance.prototype={on:function(t,e){var n=t.split(" ");return p.each(n,function(t){this.element.addEventListener(t,e,!1),this.eventHandlers.push({gesture:t,handler:e})},this),this},off:function(t,e){var n,i,r=t.split(" ");return p.each(r,function(t){for(this.element.removeEventListener(t,e,!1),n=-1;i=this.eventHandlers[++n];)i.gesture===t&&i.handler===e&&this.eventHandlers.splice(n,1)},this),this},trigger:function(t,e){e||(e={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var r=this.element;return p.hasParent(e.target,r)&&(r=e.target),r.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(this.options.stop_browser_behavior&&p.toggleDefaultBehavior(this.element,this.options.stop_browser_behavior,!0),t=-1;e=this.eventHandlers[++t];)this.element.removeEventListener(e.gesture,e.handler,!1);return this.eventHandlers=[],y.unbindDom(this.element,i.EVENT_TYPES[h],this.eventStartHandler),null}};var v=null,g=!1,m=!1,y=i.event={bindDom:function(t,e,n){var i=e.split(" ");p.each(i,function(e){t.addEventListener(e,n,!1)})},unbindDom:function(t,e,n){var i=e.split(" ");p.each(i,function(e){t.removeEventListener(e,n,!1)})},onTouch:function(t,e,n){var r=this,o=function(o){var s=o.type.toLowerCase();if(!s.match(/mouse/)||!m){s.match(/touch/)||s.match(/pointerdown/)||s.match(/mouse/)&&1===o.which?g=!0:s.match(/mouse/)&&!o.which&&(g=!1),s.match(/touch|pointer/)&&(m=!0);var a=0;g&&(i.HAS_POINTEREVENTS&&e!=f?a=b.updatePointer(e,o):s.match(/touch/)?a=o.touches.length:m||(a=s.match(/up/)?0:1),a>0&&e==f?e=d:a||(e=f),(a||null===v)&&(v=o),n.call(_,r.collectEventData(t,e,r.getTouchList(v,e),o)),i.HAS_POINTEREVENTS&&e==f&&(a=b.updatePointer(e,o))),a||(v=null,g=!1,m=!1,b.reset())}};return this.bindDom(t,i.EVENT_TYPES[e],o),o},determineEventTypes:function(){var t;t=i.HAS_POINTEREVENTS?b.getEvents():i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i.EVENT_TYPES[h]=t[0],i.EVENT_TYPES[d]=t[1],i.EVENT_TYPES[f]=t[2]},getTouchList:function(t){return i.HAS_POINTEREVENTS?b.getTouchList():t.touches?t.touches:(t.identifier=1,[t])},collectEventData:function(t,e,n,i){var r=u;return(i.type.match(/mouse/)||b.matchType(c,i))&&(r=c),{center:p.getCenter(n),timeStamp:(new Date).getTime(),target:i.target,touches:n,eventType:e,pointerType:r,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return _.stopDetect()}}}},b=i.PointerEvent={pointers:{},getTouchList:function(){var t=[];return p.each(this.pointers,function(e){t.push(e)}),t},updatePointer:function(t,e){return t==f?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e),Object.keys(this.pointers).length},matchType:function(t,e){if(!e.pointerType)return!1;var n=e.pointerType,i={};return i[c]=n===c,i[u]=n===u,i[l]=n===l,i[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},_=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:p.extend({},e),lastEvent:!1,lastVelocityEvent:!1,velocity:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst.options;return p.each(this.gestures,function(n){return this.stopped||!1===e[n.name]||!1!==n.handler.call(n,t,this.current.inst)?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=t),t.eventType==f&&!t.touches.length-1&&this.stopDetect(),t}},stopDetect:function(){this.previous=p.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current,n=e.startEvent;(t.touches.length!=n.touches.length||t.touches===n.touches)&&(n.touches=[],p.each(t.touches,function(t){n.touches.push(p.extend({},t))}));var r,o,s=t.timeStamp-n.timeStamp,a=t.center.pageX-n.center.pageX,c=t.center.pageY-n.center.pageY,u=e.lastVelocityEvent,l=e.velocity;return u&&t.timeStamp-u.timeStamp>i.UPDATE_VELOCITY_INTERVAL?(l=p.getVelocity(t.timeStamp-u.timeStamp,t.center.pageX-u.center.pageX,t.center.pageY-u.center.pageY),e.lastVelocityEvent=t,e.velocity=l):e.velocity||(l=p.getVelocity(s,a,c),e.lastVelocityEvent=t,e.velocity=l),t.eventType==f?(r=e.lastEvent&&e.lastEvent.interimAngle,o=e.lastEvent&&e.lastEvent.interimDirection):(r=e.lastEvent&&p.getAngle(e.lastEvent.center,t.center),o=e.lastEvent&&p.getDirection(e.lastEvent.center,t.center)),p.extend(t,{deltaTime:s,deltaX:a,deltaY:c,velocityX:l.x,velocityY:l.y,distance:p.getDistance(n.center,t.center),angle:p.getAngle(n.center,t.center),interimAngle:r,direction:p.getDirection(n.center,t.center),interimDirection:o,scale:p.getScale(n.touches,t.touches),rotation:p.getRotation(n.touches,t.touches),startEvent:n}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),p.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}};i.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,e){if(_.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",t),void(this.triggered=!1);if(!(e.options.drag_max_touches>0&&t.touches.length>e.options.drag_max_touches))switch(t.eventType){case h:this.triggered=!1;break;case d:if(t.distance<e.options.drag_min_distance&&_.current.name!=this.name)return;if(_.current.name!=this.name&&(_.current.name=this.name,e.options.correct_for_drag_min_distance&&t.distance>0)){var n=Math.abs(e.options.drag_min_distance/t.distance);_.current.startEvent.center.pageX+=t.deltaX*n,_.current.startEvent.center.pageY+=t.deltaY*n,t=_.extendEventData(t)}(_.current.lastEvent.drag_locked_to_axis||e.options.drag_lock_to_axis&&e.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var i=_.current.lastEvent.direction;t.drag_locked_to_axis&&i!==t.direction&&(t.direction=p.isVertical(i)?t.deltaY<0?s:r:t.deltaX<0?o:a),this.triggered||(e.trigger(this.name+"start",t),this.triggered=!0),e.trigger(this.name,t),e.trigger(this.name+t.direction,t);var c=p.isVertical(t.direction);(e.options.drag_block_vertical&&c||e.options.drag_block_horizontal&&!c)&&t.preventDefault();break;case f:this.triggered&&e.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case h:clearTimeout(this.timer),_.current.name=this.name,this.timer=setTimeout(function(){"hold"==_.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case d:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case f:clearTimeout(this.timer)}}},i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==f&&e.trigger(this.name,t)}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==f){if(t.touches.length<e.options.swipe_min_touches||t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},i.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},has_moved:!1,handler:function(t,e){var n,i,r;t.eventType==h?this.has_moved=!1:t.eventType!=d||this.moved?t.eventType==f&&"touchcancel"!=t.srcEvent.type&&t.deltaTime<e.options.tap_max_touchtime&&!this.has_moved&&(n=_.previous,i=n&&n.lastEvent&&t.timeStamp-n.lastEvent.timeStamp,r=!1,n&&"tap"==n.name&&i&&i<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance&&(e.trigger("doubletap",t),r=!0),(!r||e.options.tap_always)&&(_.current.name="tap",e.trigger(_.current.name,t))):this.has_moved=t.distance>e.options.tap_max_distance}},i.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,e){return e.options.prevent_mouseevents&&t.pointerType==c?void t.stopDetect():(e.options.prevent_default&&t.preventDefault(),void(t.eventType==h&&e.trigger(this.name,t)))}},i.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1,transform_within_instance:!1},triggered:!1,handler:function(t,e){if(_.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",t),void(this.triggered=!1);if(!(t.touches.length<2)){if(e.options.transform_always_block&&t.preventDefault(),e.options.transform_within_instance)for(var n=-1;t.touches[++n];)if(!p.hasParent(t.touches[n].target,e.element))return;switch(t.eventType){case h:this.triggered=!1;break;case d:var i=Math.abs(1-t.scale),r=Math.abs(t.rotation);if(i<e.options.transform_min_scale&&r<e.options.transform_min_rotation)return;_.current.name=this.name,this.triggered||(e.trigger(this.name+"start",t),this.triggered=!0),e.trigger(this.name,t),r>e.options.transform_min_rotation&&e.trigger("rotate",t),i>e.options.transform_min_scale&&(e.trigger("pinch",t),e.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case f:this.triggered&&e.trigger(this.name+"end",t),this.triggered=!1}}}},"function"==typeof define&&define.amd?define("hammer",[],function(){return i}):"object"==typeof module&&module.exports?module.exports=i:t.Hammer=i}(window),function(t,e){"object"==typeof exports?module.exports=e.call(t):"function"==typeof define&&define.amd?define("physicsjs",[],function(){return e.call(t)}):t.Physics=e.call(t)}(this,function(){var t=this,e=t.document,n=function t(){return t.world.apply(t,arguments)};n.util={},function(t){function e(t,e,n){n=(n||0)-1;for(var i=t?t.length:0;++n<i;)if(t[n]===e)return n;return-1}function i(t,n){var i=typeof n;if(t=t.l,"boolean"==i||null==n)return t[n]?0:-1;"number"!=i&&"string"!=i&&(i="object");var r="number"==i?n:j+n;return t=(t=t[i])&&t[r],"object"==i?t&&-1<e(t,n)?0:-1:t?0:-1}function r(t){var e=this.l,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var i="number"==n?t:j+t,e=e[n]||(e[n]={});"object"==n?(e[i]||(e[i]=[])).push(t):e[i]=!0}}function o(){return M.pop()||[]}function s(){return B.pop()||{k:null,l:null,false:!1,null:!1,number:null,object:null,push:null,string:null,true:!1,undefined:!1}}function a(){}function c(t){t.length=0,M.length<F&&M.push(t)}function u(t){var e=t.l;e&&u(e),t.k=t.l=t.object=t.number=t.string=null,B.length<F&&B.push(t)}function l(t,e,n){e||(e=0),void 0===n&&(n=t?t.length:0);var i=-1;n=n-e||0;for(var r=Array(0>n?0:n);++i<n;)r[i]=t[e+i];return r}function h(){}function d(t,e,n,i,r){if(n){var s=n(t);if(void 0!==s)return s}if(!b(t))return t;var a=at.call(t);if(!$[a])return t;var u=yt[a];switch(a){case V:case q:return new u(+t);case X:case U:return new u(t);case Y:return s=u(t.source,R.exec(t)),s.lastIndex=t.lastIndex,s}if(a=wt(t),e){var h=!i;i||(i=o()),r||(r=o());for(var f=i.length;f--;)if(i[f]==t)return r[f];s=a?u(t.length):{}}else s=a?l(t):Tt({},t);return a&&(rt.call(t,"index")&&(s.index=t.index),rt.call(t,"input")&&(s.input=t.input)),e?(i.push(t),r.push(s),(a?x:kt)(t,function(t,o){s[o]=d(t,e,n,i,r)}),h&&(c(i),c(r)),s):s}function f(t,e,n){if("function"!=typeof t)return A;if(void 0===e)return t;var i=t.__bindData__||bt.funcNames&&!t.name;if(void 0===i){var r=N&&nt.call(t);bt.funcNames||!r||W.test(r)||(i=!0),!bt.funcNames&&i||(i=!bt.funcDecomp||N.test(r),_t(t,i))}if(!0!==i&&i&&1&i[1])return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return I(t,e)}function p(t,e,n,i,r,s){if(n){var a=n(t,e);if(void 0!==a)return!!a}if(t===e)return 0!==t||1/t==1/e;if(t===t&&!(t&&Z[typeof t]||e&&Z[typeof e]))return!1;if(null==t||null==e)return t===e;var u=at.call(t),l=at.call(e);if(u==L&&(u=z),l==L&&(l=z),u!=l)return!1;switch(u){case V:case q:return+t==+e;case X:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Y:case U:return t==String(e)}if(!(l=u==H)){if(rt.call(t,"__wrapped__")||rt.call(e,"__wrapped__"))return p(t.__wrapped__||t,e.__wrapped__||e,n,i,r,s);if(u!=z)return!1;var u=t.constructor,h=e.constructor;if(u!=h&&!(y(u)&&u instanceof u&&y(h)&&h instanceof h))return!1}for(h=!r,r||(r=o()),s||(s=o()),u=r.length;u--;)if(r[u]==t)return s[u]==e;var d=0,a=!0;if(r.push(t),s.push(e),l){if(u=t.length,d=e.length,!(a=d==t.length)&&!i)return a;for(;d--;)if(l=u,h=e[d],i)for(;l--&&!(a=p(t[l],h,n,i,r,s)););else if(!(a=p(t[d],h,n,i,r,s)))break;return a}return Et(e,function(e,o,c){if(rt.call(c,o))return d++,a=rt.call(t,o)&&p(t[o],e,n,i,r,s)}),a&&!i&&Et(t,function(t,e,n){if(rt.call(n,e))return a=-1<--d}),h&&(c(r),c(s)),a}function v(t,e,n,i,r,o){var s=1&e,a=2&e,c=4&e,u=8&e,l=16&e,h=32&e,d=t;if(!a&&!y(t))throw new TypeError;l&&!n.length&&(e&=-17,l=n=!1),h&&!i.length&&(e&=-33,h=i=!1);var f=t&&t.__bindData__;if(f)return!s||1&f[1]||(f[4]=r),!s&&1&f[1]&&(e|=8),!c||4&f[1]||(f[5]=o),l&&st.apply(f[2]||(f[2]=[]),n),h&&st.apply(f[3]||(f[3]=[]),i),f[1]|=e,v.apply(null,f);if(!s||a||c||h||!(bt.fastBind||lt&&l))m=function(){var f=arguments,p=s?r:this;return(c||l||h)&&(f=mt.call(f),l&&ct.apply(f,n),h&&st.apply(f,i),c&&f.length<o)?(e|=16,v(t,u?e:-4&e,f,null,r,o)):(a&&(t=p[d]),this instanceof m?(p=g(t.prototype),f=t.apply(p,f),b(f)?f:p):t.apply(p,f))};else{if(l){var p=[r];st.apply(p,n)}var m=l?lt.apply(t,p):lt.call(t,r)}return _t(m,mt.call(arguments)),m}function g(t){return b(t)?ht(t):{}}function m(t){var e,n;return!!(t&&at.call(t)==z&&(e=t.constructor,!y(e)||e instanceof e))&&(Et(t,function(t,e){n=e}),void 0===n||rt.call(t,n))}function y(t){return"function"==typeof t}function b(t){return!(!t||!Z[typeof t])}function _(t,e,n){var i=[];e=h.createCallback(e,n,3),n=-1;var r=t?t.length:0;if("number"==typeof r)for(;++n<r;){var o=t[n];e(o,n,t)&&i.push(o)}else kt(t,function(t,n,r){e(t,n,r)&&i.push(t)});return i}function w(t,e,n){e=h.createCallback(e,n,3),n=-1;var i=t?t.length:0;if("number"!=typeof i){var r;return kt(t,function(t,n,i){if(e(t,n,i))return r=t,!1}),r}for(;++n<i;){var o=t[n];if(e(o,n,t))return o}}function x(t,e,n){var i=-1,r=t?t.length:0;if(e=e&&void 0===n?e:f(e,n,3),"number"==typeof r)for(;++i<r&&!1!==e(t[i],i,t););else kt(t,e);return t}function T(t,n,i){if("number"==typeof i){var r=t?t.length:0;i=0>i?pt(0,r+i):i||0}else if(i)return i=E(t,n),t[i]===n?i:-1;return e(t,n,i)}function E(t,e,n,i){var r=0,o=t?t.length:r;for(n=n?h.createCallback(n,i,1):A,e=n(e);r<o;)i=r+o>>>1,n(t[i])<e?r=i+1:o=i;return r}function k(t,n,a,l){"boolean"!=typeof n&&null!=n&&(a=(l=a)&&l[n]===t?null:n,n=!1),null!=a&&(a=h.createCallback(a,l,3)),l=-1;var d;d=(d=h.indexOf)===T?e:d;var f=t?t.length:0,p=[],v=!n&&f>=O&&d===e,g=a||v?o():p;if(v){var m;m=g;var y=-1,b=m.length,_=m[0],w=m[b/2|0],x=m[b-1];if(_&&"object"==typeof _&&w&&"object"==typeof w&&x&&"object"==typeof x)m=!1;else{for(_=s(),_.false=_.null=_.true=_.undefined=!1,w=s(),w.k=m,w.l=_,w.push=r;++y<b;)w.push(m[y]);m=w}m?(d=i,g=m):(v=!1,g=a?g:(c(g),p))}for(;++l<f;)m=t[l],y=a?a(m,l,t):m,(n?!l||g[g.length-1]!==y:0>d(g,y))&&((a||v)&&g.push(y),p.push(m));return v?(c(g.k),u(g)):a&&c(g),p}function I(t,e){return 2<arguments.length?v(t,17,mt.call(arguments,2),null,e):v(t,1,null,null,e)}function P(t,e,n){var i,r,o,s,a,c,u,l=0,h=!1,d=!0;if(!y(t))throw new TypeError;if(e=pt(0,e)||0,!0===n)var f=!0,d=!1;else b(n)&&(f=n.leading,h="maxWait"in n&&(pt(e,n.maxWait)||0),d="trailing"in n?n.trailing:d);var p=function(){var n=e-(ot()-s);0>=n?(r&&clearTimeout(r),n=u,r=c=u=C,n&&(l=ot(),o=t.apply(a,i))):c=setTimeout(p,n)},v=function(){c&&clearTimeout(c),r=c=u=C,(d||h!==e)&&(l=ot(),o=t.apply(a,i))};return function(){if(i=arguments,s=ot(),a=this,u=d&&(c||!f),!1===h)var n=f&&!c;else{r||f||(l=s);var g=h-(s-l);0>=g?(r&&(r=clearTimeout(r)),l=s,o=t.apply(a,i)):r||(r=setTimeout(v,g))}return c||e===h||(c=setTimeout(p,e)),n&&(o=t.apply(a,i)),o}}function A(t){return t}function S(t,e,n){var i=null==t,r=null==e;return null==n&&("boolean"==typeof t&&r?(n=t,t=1):r||"boolean"!=typeof e||(n=e,r=!0)),i&&r&&(e=1),t=+t||0,r?(e=t,t=0):e=+e||0,i=gt(),n||t%1||e%1?vt(t+i*(e-t+parseFloat("1e-"+((i+"").length-1))),e):t+et(i*(e-t+1))}var C,M=[],B=[],D=0,j=+new Date+"",O=75,F=40,R=/\w*$/,W=/^function[ \n\r\t]+\w/,N=/\bthis\b/,L="[object Arguments]",H="[object Array]",V="[object Boolean]",q="[object Date]",X="[object Number]",z="[object Object]",Y="[object RegExp]",U="[object String]",$={"[object Function]":!1};$[L]=$[H]=$[V]=$[q]=$[X]=$[z]=$[Y]=$[U]=!0;var J={leading:!1,maxWait:0,trailing:!1},G={configurable:!1,enumerable:!1,value:null,writable:!1},Z={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1};t=Z[typeof t]&&t||this;var K=[],Q=Object.prototype,tt=RegExp("^"+String(Q.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),et=Math.floor,nt=Function.prototype.toString,it=tt.test(it=Object.getPrototypeOf)&&it,rt=Q.hasOwnProperty,ot=tt.test(ot=Date.now)&&ot||function(){return+new Date},st=K.push,at=Q.toString,ct=K.unshift,ut=function(){try{var t={},e=tt.test(e=Object.defineProperty)&&e,n=e(t,t,t)&&e}catch(t){}return n}(),lt=tt.test(lt=at.bind)&&lt,ht=tt.test(ht=Object.create)&&ht,dt=tt.test(dt=Array.isArray)&&dt,ft=tt.test(ft=Object.keys)&&ft,pt=Math.max,vt=Math.min,gt=Math.random,mt=K.slice,K=tt.test(t.attachEvent),K=lt&&!/\n|true/.test(lt+K),yt={};yt[H]=Array,yt[V]=Boolean,yt[q]=Date,yt["[object Function]"]=Function,yt[z]=Object,yt[X]=Number,yt[Y]=RegExp,yt[U]=String;var bt=h.support={};bt.fastBind=lt&&!K,bt.funcDecomp=!tt.test(t.WinRTError)&&N.test(function(){return this}),bt.funcNames="string"==typeof Function.name,ht||(g=function(t){if(b(t)){a.prototype=t;var e=new a;a.prototype=null}return e||{}});var _t=ut?function(t,e){G.value=e,ut(t,"__bindData__",G)}:a,wt=dt||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&at.call(t)==H||!1},dt=function(t){var e,n=[];if(!t||!Z[typeof t])return n;for(e in t)rt.call(t,e)&&n.push(e);return n},xt=ft?function(t){return b(t)?ft(t):[]}:dt,Tt=function(t,e,n){var i,r=t,o=r;if(!r)return o;var s=arguments,a=0,c="number"==typeof n?2:s.length;if(3<c&&"function"==typeof s[c-2])var u=f(s[--c-1],s[c--],2);else 2<c&&"function"==typeof s[c-1]&&(u=s[--c]);for(;++a<c;)if((r=s[a])&&Z[typeof r])for(var l=-1,h=Z[typeof r]&&xt(r),d=h?h.length:0;++l<d;)i=h[l],o[i]=u?u(o[i],r[i]):r[i];return o},Et=function(t,e,n){var i;if(!t||!Z[typeof t])return t;e=e&&void 0===n?e:f(e,n,3);for(i in t)if(!1===e(t[i],i,t))break;return t},kt=function(t,e,n){if(!t||!Z[typeof t])return t;e=e&&void 0===n?e:f(e,n,3);for(var i=-1,r=Z[typeof t]&&xt(t),o=r?r.length:0;++i<o&&(n=r[i],!1!==e(t[n],n,t)););return t};h.assign=Tt,h.bind=I,h.createCallback=function(t,e,n){var i=typeof t;if(null==t||"function"==i)return f(t,e,n);if("object"!=i)return function(e){return e[t]};var r=xt(t),o=r[0],s=t[o];return 1!=r.length||s!==s||b(s)?function(e){for(var n=r.length,i=!1;n--&&(i=p(e[r[n]],t[r[n]],null,!0)););return i}:function(t){return t=t[o],s===t&&(0!==s||1/s==1/t)}},h.debounce=P,h.defaults=function(t,e,n){var i,r=t,o=r;if(!r)return o;for(var s=arguments,a=0,c="number"==typeof n?2:s.length;++a<c;)if((r=s[a])&&Z[typeof r])for(var u=-1,l=Z[typeof r]&&xt(r),h=l?l.length:0;++u<h;)i=l[u],void 0===o[i]&&(o[i]=r[i]);return o},h.filter=_,h.forEach=x,h.forIn=Et,h.forOwn=kt,h.keys=xt,h.shuffle=function(t){var e=-1,n=t?t.length:0,i=Array("number"==typeof n?n:0);return x(t,function(t){var n=S(++e);i[e]=i[n],i[n]=t}),i},h.throttle=function(t,e,n){var i=!0,r=!0;if(!y(t))throw new TypeError;return!1===n?i=!1:b(n)&&(i="leading"in n?n.leading:i,r="trailing"in n?n.trailing:r),J.leading=i,J.maxWait=e,J.trailing=r,P(t,e,J)},h.transform=function(t,e,n,i){var r=wt(t);return e=f(e,i,4),null==n&&(r?n=[]:(i=t&&t.constructor,n=g(i&&i.prototype))),(r?x:kt)(t,function(t,i,r){return e(n,t,i,r)}),n},h.uniq=k,h.each=x,h.extend=Tt,h.select=_,h.unique=k,h.clone=function(t,e,n,i){return"boolean"!=typeof e&&null!=e&&(i=n,n=e,e=!1),d(t,e,"function"==typeof n&&f(n,i,1))},h.find=w,h.identity=A,h.indexOf=T,h.isArray=wt,h.isFunction=y,h.isObject=b,h.isPlainObject=function(t){if(!t||at.call(t)!=z)return!1;var e=t.valueOf,n="function"==typeof e&&(n=it(e))&&it(n);return n?t==n||it(t)==n:m(t)},h.random=S,h.sortedIndex=E,h.uniqueId=function(t){var e=++D;return String(null==t?"":t)+e},h.detect=w,h.findWhere=w,h.VERSION="2.2.1",h.extend(n.util,h)}(this);var i=n.util.decorator=function(t,e){var i={},r={},o=function(t,e,i,r){var o=Object.getOwnPropertyDescriptor(r,i);o.get||o.set?Object.defineProperty(t,i,o):n.util.isFunction(o.value)&&(t[i]=o.value)},s=function(t,e){return n.util.transform(e,o,t)},a=Object.getPrototypeOf;"function"!=typeof a&&(a="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype});var c=Object.create;"function"!=typeof c&&(c=function(t){function e(){}return e.prototype=t,new e});var u=function(e,i){
if("object"==typeof e)return r=s(r,e),void(r.type=t);"type"!==e&&n.util.isFunction(i)&&(r[e]=i)};u(e);var l=function(e,n,o,u){var l,h=r;if("string"!=typeof n)u=o,o=n;else{if(!(h=i[n]))throw'Error: "'+n+'" '+t+" not defined";h=h.prototype}if("function"==typeof o)l=i[e],l?l.prototype=s(l.prototype,o(a(l.prototype))):(l=i[e]=function(t){this.init&&this.init(t)},l.prototype=c(h),l.prototype=s(l.prototype,o(h,l.prototype))),l.prototype.type=t,l.prototype.name=e;else if(u=o||{},!(l=i[e]))throw'Error: "'+e+'" '+t+" not defined";if(u)return new l(u)};return l.mixin=u,l};return n.util.indexOf=function(t,e){for(var n=0,i=t.length;n<i;){if(i--,t[n]===e)return n;if(t[i]===e)return i;n++}return-1},n.util.options=function(t,e,i){var r,o={},s=[];return r=function(t){n.util.extend(e,t,null);for(var i=0,r=s.length;i<r;++i)s[i](e);return e},r.defaults=function(t){return n.util.extend(o,t),n.util.defaults(e,o),o},r.onChange=function(t){s.push(t)},e=e||r,r.defaults(t),r},function(t){var e=t.Physics;n.noConflict=function(){return t.Physics===n&&(t.Physics=e),n}}(this),function(){var t=function t(){if(!(this instanceof t))return new t};t.prototype={on:function(t,e,i,r){var o,s,a;if(this._topics=this._topics||(this._topics={}),n.util.isObject(t)){for(var c in t)this.on(c,t[c],e,i);return this}return o=this._topics[t]||(this._topics[t]=[]),s=e,n.util.isObject(i)?(e=n.util.bind(e,i),e._bindfn_=s,e._one_=s._one_):r||(r=i),e._priority_=r,a=n.util.sortedIndex(o,e,"_priority_"),o.splice(a,0,e),this},off:function(t,e){var i,r;if(!this._topics)return this;if(!0===t)return this._topics={},this;if(n.util.isObject(t)){for(var o in t)this.off(o,t[o]);return this}if(!(i=this._topics[t]))return this;if(!0===e)return this._topics[t]=[],this;for(var s=0,a=i.length;s<a;s++)if(r=i[s],r._bindfn_===e||r===e){i.splice(s,1);break}return this},emit:function(t,e){if(!this._topics)return this;var n,i=this._topics[t],r=i&&i.length;if(!r)return this;for(;r--;)n=i[r],n(e,{topic:t,handler:n}),n._one_&&i.splice(r,1);return this},one:function(t,e,i){if(n.util.isObject(t)){for(var r in t)this.one(r,t[r],e,i);return this}return e._one_=!0,this.on(t,e,i),this}},n.util.pubsub=t}(),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var e=["webkit","moz"],n=0;n<e.length&&!t.requestAnimationFrame;++n){var i=e[n];t.requestAnimationFrame=t[i+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i+"CancelAnimationFrame"]||t[i+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(t.navigator.userAgent)||!t.requestAnimationFrame||!t.cancelAnimationFrame){var r=0;t.requestAnimationFrame=function(t){var e=Date.now(),n=Math.max(r+16,e);return setTimeout(function(){t(r=n)},n-e)},t.cancelAnimationFrame=clearTimeout}}(),function(){var t="Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)",e="Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)",i=[],r=0,o=function(){if(this.objIndex=0,this.arrayIndex=0,this.vectorIndex=0,this.aabbIndex=0,this.transformIndex=0,this.objectStack=[],this.arrayStack=[],this.vectorStack=[],this.aabbStack=[],this.transformStack=[],++r>=100)throw"Error: Too many scratchpads created. (Did you forget to call .done()?)"};o.prototype={done:function(){this._active=!1,this.objIndex=this.arrayIndex=this.vectorIndex=this.aabbIndex=this.transformIndex=0,i.push(this)},object:function(){var n=this.objectStack;if(!this._active)throw t;if(this.objIndex>=10)throw e;return n[this.objIndex++]||n[n.push({})-1]},array:function(){var n=this.arrayStack;if(!this._active)throw t;if(this.arrIndex>=10)throw e;return n[this.arrIndex++]||n[n.push([])-1]},vector:function(){var i=this.vectorStack;if(!this._active)throw t;if(this.vectorIndex>=10)throw e;return i[this.vectorIndex++]||i[i.push(n.vector())-1]},aabb:function(){var i=this.aabbStack;if(!this._active)throw t;if(this.aabbIndex>=10)throw e;return i[this.aabbIndex++]||i[i.push(n.aabb())-1]},transform:function(){var i=this.transformStack;if(!this._active)throw t;if(this.transformIndex>=10)throw e;return i[this.transformIndex++]||i[i.push(n.transform())-1]}},n.scratchpad=function(){var t=i.pop()||new o;return t._active=!0,t}}(),function(t){function e(){return h&&h.now?h.now()+h.timing.navigationStart:Date.now()}function i(e){u&&(t.requestAnimationFrame(i),l.emit("tick",e))}function r(){return u=!0,i(),this}function o(){return u=!1,this}function s(t){return l.on("tick",t),this}function a(t){return l.off("tick",t),this}function c(){return!!u}var u=!1,l=n.util.pubsub(),h=t.performance;n.util.ticker={now:e,start:r,stop:o,on:s,off:a,isActive:c}}(this),function(){var t=function t(e,i,r,o){if(!(this instanceof t))return new t(e,i,r,o);this._pos=n.vector(),this.set(e,i,r,o)};t.prototype.set=function(t,e,i,r){return n.util.isObject(t)?(this._pos.clone(t.pos),this._hw=t.halfWidth,this._hh=t.halfHeight,this):(this._pos.set(.5*(i+t),.5*(r+e)),this._hw=.5*(i-t),this._hh=.5*(r-e),this)},t.prototype.get=function(){var t=this.halfWidth(),e=this.halfHeight();return{pos:this._pos.values(),halfWidth:t,halfHeight:e,x:t,y:e}},t.prototype.halfWidth=function(){return this._hw},t.prototype.halfHeight=function(){return this._hh},t.prototype.contains=function(t){var e=void 0!==t.x?t.x:t.get(0),n=void 0!==t.y?t.y:t.get(1);return e>this._pos.get(0)-this._hw&&e<this._pos.get(0)+this._hw&&n>this._pos.get(1)-this._hh&&n<this._pos.get(1)+this._hh},t.prototype.transform=function(t){var e=this._hw,i=this._hh,r=n.scratchpad(),o=r.vector().set(e,i),s=r.vector().set(e,-i);return this._pos.translate(t),o.rotate(t),s.rotate(t),this._hw=Math.max(Math.abs(o.get(0)),Math.abs(s.get(0))),this._hh=Math.max(Math.abs(o.get(1)),Math.abs(s.get(1))),r.done(),this},t.contains=function(t,e){var n=void 0!==e.x?e.x:e.get(0),i=void 0!==e.y?e.y:e.get(1);return t=t.get?t.get():t,n>t.pos.x-t.halfWidth&&n<t.pos.x+t.halfWidth&&i>t.pos.y-t.halfHeight&&i<t.pos.y+t.halfHeight},n.aabb=t}(),function(){var t=function(t,e,n){var i=e.normSq()-e.dot(t),r=e.dot(t)-t.normSq();return i<0?n.clone(e).negate():r>0?n.clone(t).negate():(n.clone(e).vsub(t),n.perp(t.cross(n)>0))},e=function(t){var e,i,r=t.length,o=t[r-2],s=t[r-3],a=n.scratchpad(),c=a.vector().clone(o.pt),u=a.vector().clone(s.pt).vsub(c);if(u.equals(n.vector.zero))return a.done(),{a:o.a,b:o.b};if(e=-u.dot(c)/u.normSq(),(i=1-e)<=0)return a.done(),{a:s.a,b:s.b};if(e<=0)return a.done(),{a:o.a,b:o.b};var l={a:c.clone(o.a).mult(i).vadd(u.clone(s.a).mult(e)).values(),b:c.clone(o.b).mult(i).vadd(u.clone(s.b).mult(e)).values()};return a.done(),l};n.gjk=function(i,r,o,s){var a,c,u,l,h=!1,d=!1,f=!1,p=[],v=1,g=n.scratchpad(),m=g.vector().clone(r||n.vector.axis[0]),y=g.vector(),b=g.vector(),_=g.vector(),w=g.vector(),x=0;for(l=i(m),v=p.push(l),y.clone(l.pt),m.negate();++x;){if(y.swap(b),l=i(m),v=p.push(l),y.clone(l.pt),s&&s(p),y.equals(n.vector.zero)){h=!0;break}if(!d&&y.dot(m)<=0){if(o)break;d=!0}if(2===v)m=t(y,b,m);else if(d){if(m.normalize(),l=b.dot(m),Math.abs(l-y.dot(m))<1e-4){f=-l;break}b.normSq()<_.clone(p[0].pt).normSq()?p.shift():p.splice(1,1),m=t(_.clone(p[1].pt),w.clone(p[0].pt),m)}else if(a=a||g.vector(),c=c||g.vector(),a.clone(b).vsub(y),c.clone(p[0].pt).vsub(y),(u=a.cross(c)>0)^y.cross(a)>0)p.shift(),a.perp(!u),m.swap(a);else{if(!(u^c.cross(y)>0)){h=!0;break}p.splice(1,1),c.perp(u),m.swap(a)}if(x>100)return g.done(),{simplex:p,iterations:x,distance:0,maxIterationsReached:!0}}return g.done(),l={overlap:h,simplex:p,iterations:x},!1!==f&&(l.distance=f,l.closest=e(p)),l}}(),function(){var t=function t(e,i,r){return this instanceof t?(this.v=n.vector(),this.o=n.vector(),e instanceof t?void this.clone(e):(e&&this.setTranslation(e),void this.setRotation(i||0,r))):new t(e,i)};t.prototype.setTranslation=function(t){return this.v.clone(t),this},t.prototype.setRotation=function(t,e){return this.cosA=Math.cos(t),this.sinA=Math.sin(t),e?this.o.clone(e):this.o.zero(),this},t.prototype.clone=function(e){return e?(this.setTranslation(e.v),this.cosA=e.cosA,this.sinA=e.sinA,this.o.clone(e.o),this):new t(this)},n.transform=t}(),function(t){var e=Math.sqrt,i=Math.min,r=Math.max,o=(Math.acos,Math.atan2),s=2*Math.PI,a=!!t.Float64Array,c=function t(e,n){if(!(this instanceof t))return new t(e,n);this._=a?new Float64Array(5):[],e&&(void 0!==e.x||e._&&e._.length)?this.clone(e):(this.recalc=!0,this.set(e||0,n||0))};c.prototype.set=function(t,e){return this.recalc=!0,this._[0]=t||0,this._[1]=e||0,this},c.prototype.get=function(t){return this._[t]},c.prototype.vadd=function(t){return this.recalc=!0,this._[0]+=t._[0],this._[1]+=t._[1],this},c.prototype.vsub=function(t){return this.recalc=!0,this._[0]-=t._[0],this._[1]-=t._[1],this},c.prototype.add=function(t,e){return this.recalc=!0,this._[0]+=t,this._[1]+=void 0===e?t:e,this},c.prototype.sub=function(t,e){return this.recalc=!0,this._[0]-=t,this._[1]-=void 0===e?t:e,this},c.prototype.mult=function(t){return this.recalc||(this._[4]*=t*t,this._[3]*=t),this._[0]*=t,this._[1]*=t,this},c.prototype.dot=function(t){return this._[0]*t._[0]+this._[1]*t._[1]},c.prototype.cross=function(t){return-this._[0]*t._[1]+this._[1]*t._[0]},c.prototype.proj=function(t){return this.dot(t)/t.norm()},c.prototype.vproj=function(t){var e=this.dot(t)/t.normSq();return this.clone(t).mult(e)},c.prototype.angle=function(t){var e;if(this.equals(c.zero))return t?t.angle():NaN;for(e=t&&!t.equals(c.zero)?o(this._[1]*t._[0]-this._[0]*t._[1],this._[0]*t._[0]+this._[1]*t._[1]):o(this._[1],this._[0]);e>Math.PI;)e-=s;for(;e<-Math.PI;)e+=s;return e},c.prototype.angle2=function(t,e){for(var n=t._[0]-this._[0],i=t._[1]-this._[1],r=e._[0]-this._[0],a=e._[1]-this._[1],c=o(i*r-n*a,n*r+i*a);c>Math.PI;)c-=s;for(;c<-Math.PI;)c+=s;return c},c.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[3]},c.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[4]},c.prototype.dist=function(t){var n,i;return e((n=t._[0]-this._[0])*n+(i=t._[1]-this._[1])*i)},c.prototype.distSq=function(t){var e,n;return(e=t._[0]-this._[0])*e+(n=t._[1]-this._[1])*n},c.prototype.perp=function(t){var e=this._[0];return t?(this._[0]=this._[1],this._[1]=-e):(this._[0]=-this._[1],this._[1]=e),this},c.prototype.normalize=function(){var t=this.norm();return 0===t?this:(t=1/t,this._[0]*=t,this._[1]*=t,this._[3]=1,this._[4]=1,this)},c.prototype.transform=function(t){var e=t.sinA,n=t.cosA,i=t.o._[0],r=t.o._[1];return this._[0]-=i,this._[1]-=r,this.set(this._[0]*n-this._[1]*e+i+t.v._[0],this._[0]*e+this._[1]*n+r+t.v._[1])},c.prototype.transformInv=function(t){var e=t.sinA,n=t.cosA,i=t.o._[0],r=t.o._[1];return this._[0]-=i+t.v._[0],this._[1]-=r+t.v._[1],this.set(this._[0]*n+this._[1]*e+i,-this._[0]*e+this._[1]*n+r)},c.prototype.rotate=function(t,e){var n,i,r=0,o=0;return"number"==typeof t?(n=Math.sin(t),i=Math.cos(t),e&&(r=0|(e.x||e._[0]),o=0|(e.y||e._[1]))):(n=t.sinA,i=t.cosA,r=t.o._[0],o=t.o._[1]),this._[0]-=r,this._[1]-=o,this.set(this._[0]*i-this._[1]*n+r,this._[0]*n+this._[1]*i+o)},c.prototype.rotateInv=function(t){return this.set((this._[0]-t.o._[0])*t.cosA+(this._[1]-t.o._[1])*t.sinA+t.o._[0],-(this._[0]-t.o._[0])*t.sinA+(this._[1]-t.o._[1])*t.cosA+t.o._[1])},c.prototype.translate=function(t){return this.vadd(t.v)},c.prototype.translateInv=function(t){return this.vsub(t.v)},c.prototype.clone=function(t){return t?t._?(this.recalc=t.recalc,t.recalc||(this._[3]=t._[3],this._[4]=t._[4]),this._[0]=t._[0],this._[1]=t._[1],this):this.set(t.x,t.y):new c(this)},c.prototype.swap=function(t){var e=this._;return this._=t._,t._=e,e=this.recalc,this.recalc=t.recalc,t.recalc=e,this},c.prototype.values=function(){return{x:this._[0],y:this._[1]}},c.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},c.prototype.negate=function(t){return void 0!==t?(this._[t]=-this._[t],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},c.prototype.clamp=function(t,e){return t=t.values?t.values():t,e=e.values?e.values():e,this._[0]=i(r(this._[0],t.x),e.x),this._[1]=i(r(this._[1],t.y),e.y),this.recalc=!0,this},c.prototype.toString=function(){return"("+this._[0]+", "+this._[1]+")"},c.prototype.equals=function(t){return this._[0]===t._[0]&&this._[1]===t._[1]&&this._[2]===t._[2]},c.vadd=function(t,e){return new c(t._[0]+e._[0],t._[1]+e._[1])},c.vsub=function(t,e){return new c(t._[0]-e._[0],t._[1]-e._[1])},c.mult=function(t,e){return new c(e._[0]*t,e._[1]*t)},c.vproj=function(t,e){return c.mult(t.dot(e)/e.normSq(),e)},c.axis=[new c(1,0),new c(0,1)],c.zero=new c(0,0),n.vector=c}(this),function(t){var e=function(){return!0},i=n.util.indexOf,r=function(t,e){return function(n){return t(n[e])}},o=function(t,e){return function(r){r=e?r[e]:r;var o,s=0;if(n.util.isArray(r)){if(n.util.isArray(t)){if((o=r.length)!==t.length)return!1;for(;s<o;){if(o--,-1===i(t,r[s])||-1===i(t,r[o]))return!1;s++}return!0}return i(r,t)>-1}return r===t}},s=function(t,e){var n=o(t,e);return function(t){return!n(t)}},a=function(t,e){return function(r){r=e?r[e]:r;var o,s=0;if(n.util.isArray(r)){for(o=r.length;s<o;){if(o--,i(t,r[s])>-1||i(t,r[o])>-1)return!0;s++}return!1}return i(t,r)>-1}},c=function(t,e){var n=a(t,e);return function(t){return!n(t)}},u=function(t){return t=n.vector(t),function(e){var i=e.aabb();return n.aabb.contains(i,t)}},l=function(t){return t.next?function(e){for(var n=t;n;){if(!n(e))return!1;n=n.next}return!0}:t},h=function(t){return t.next?function(e){for(var n=t;n;){if(n(e))return!0;n=n.next}return!1}:t},d={$eq:o,$ne:s,$in:a,$nin:c,$at:u};n.query=function t(i,s){var a,c,u,f,p,v;if(s){if("$or"===s||"$and"===s){for(a=0,c=i.length;a<c;++a)v=t(i[a]),p=p?p.next=v:f=v;return"$or"===s?h(f):l(f)}if(a=d[s])return a(i);throw"Unknown query operation: "+s}for(a in i)u=i[a],v="$"===a[0]?t(u,a):n.util.isPlainObject(u)?r(t(u),a):o(u,a),p=p?p.next=v:f=v;return l(f||e)}}(),function(){var t={priority:0};n.behavior=i("behavior",{init:function(e){this.options=n.util.options(t),this.options(e)},applyTo:function(t){return this._targets=!0===t?null:n.util.uniq(t),this},getTargets:function(){return this._targets||(this._world?this._world._bodies:[])},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},connect:function(t){this.behave&&t.on("integrate:positions",this.behave,this,this.options.priority)},disconnect:function(t){this.behave&&t.off("integrate:positions",this.behave)},behave:null})}(),function(){var t={hidden:!1,treatment:"dynamic",mass:1,restitution:1,cof:.8,view:null};n.body=i("body",{init:function(e){var i=n.vector;if(this.options=n.util.options(t,this),this.options(e),this.state={pos:i(this.x,this.y),vel:i(this.vx,this.vy),acc:i(),angular:{pos:this.angle||0,vel:this.angularVelocity||0,acc:0},old:{pos:i(),vel:i(),acc:i(),angular:{pos:0,vel:0,acc:0}}},delete this.x,delete this.y,delete this.vx,delete this.vy,delete this.angle,delete this.angularVelocity,0===this.mass)throw"Error: Bodies must have non-zero mass";this.geometry=n.geometry("point")},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},accelerate:function(t){return"dynamic"===this.treatment&&this.state.acc.vadd(t),this},applyForce:function(t,e){if("dynamic"!==this.treatment)return this;var i=n.scratchpad(),r=i.vector();return e?this.moi&&(this.state,r.clone(e),this.state.angular.acc-=r.cross(t)/this.moi,this.applyForce(t)):this.accelerate(r.clone(t).mult(1/this.mass)),i.done(),this},aabb:function(){var t=n.scratchpad(),e=t.transform(),i=this.state.angular.pos,r=t.aabb().set(this.geometry.aabb(i));return e.setRotation(0).setTranslation(this.state.pos),r.transform(e),r=r.get(),t.done(),r},recalc:function(){}})}(),function(){n.geometry=i("geometry",{init:function(t){this._aabb=new n.aabb},aabb:function(t){return this._aabb.get()},getFarthestHullPoint:function(t,e){return e=e||n.vector(),e.set(0,0)},getFarthestCorePoint:function(t,e,i){return e=e||n.vector(),e.set(0,0)}})}(),n.geometry.isPolygonConvex=function(t){var e=n.scratchpad(),i=e.vector(),r=e.vector(),o=e.vector(),s=!0,a=!1,c=t.length;if(!t||!c)return!1;if(c<3)return e.done(),s;i.clone(t[0]).vsub(o.clone(t[c-1]));for(var u=1;u<=c;++u){if(r.clone(t[u%c]).vsub(o.clone(t[(u-1)%c])),!1===a)a=i.cross(r);else if(a>0^i.cross(r)>0){s=!1;break}r.swap(i)}return e.done(),s},n.geometry.getPolygonMOI=function(t){var e,i=n.scratchpad(),r=i.vector(),o=i.vector(),s=0,a=0,c=t.length;if(c<2)return i.done(),0;if(2===c)return e=o.clone(t[1]).distSq(r.clone(t[0])),i.done(),e/12;r.clone(t[0]);for(var u=1;u<c;++u)o.clone(t[u]),e=Math.abs(o.cross(r)),s+=e*(o.normSq()+o.dot(r)+r.normSq()),a+=e,r.swap(o);return i.done(),s/(6*a)},n.geometry.isPointInPolygon=function(t,e){var i=n.scratchpad(),r=i.vector().clone(t),o=i.vector(),s=i.vector(),a=0,c=e.length;if(c<2)return a=r.equals(o.clone(e[0])),i.done(),a;if(2===c)return a=r.angle(o.clone(e[0])),a+=r.angle(o.clone(e[1])),i.done(),Math.abs(a)===Math.PI;o.clone(e[0]).vsub(r);for(var u=1;u<=c;++u)s.clone(e[u%c]).vsub(r),a+=s.angle(o),o.swap(s);return i.done(),Math.abs(a)>1e-6},n.geometry.getPolygonArea=function(t){var e=n.scratchpad(),i=e.vector(),r=e.vector(),o=0,s=t.length;if(s<3)return e.done(),0;i.clone(t[s-1]);for(var a=0;a<s;++a)r.clone(t[a]),o+=i.cross(r),i.swap(r);return e.done(),o/2},n.geometry.getPolygonCentroid=function(t){var e,i=n.scratchpad(),r=i.vector(),o=i.vector(),s=n.vector(),a=t.length;if(a<2)return i.done(),n.vector(t[0]);if(2===a)return i.done(),n.vector((t[1].x+t[0].x)/2,(t[1].y+t[0].y)/2);r.clone(t[a-1]);for(var c=0;c<a;++c)o.clone(t[c]),e=r.cross(o),r.vadd(o).mult(e),s.vadd(r),r.swap(o);return e=1/(6*n.geometry.getPolygonArea(t)),i.done(),s.mult(e)},n.geometry.nearestPointOnLine=function(t,e,i){var r,o,s=n.scratchpad(),a=s.vector().clone(t),c=s.vector().clone(e).vsub(a),u=s.vector().clone(i).vsub(a).vsub(c);return u.equals(n.vector.zero)?(s.done(),n.vector(e)):(r=-u.dot(c)/u.normSq(),(o=1-r)<=0?(s.done(),n.vector(i)):r<=0?(s.done(),n.vector(e)):(a=n.vector(i).mult(r).vadd(c.clone(e).mult(o)),s.done(),a))},function(){var t={drag:0};n.integrator=i("integrator",{init:function(e){this.options=n.util.options(t)},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},integrate:function(t,e){var n=this._world;return this.integrateVelocities(t,e),n&&n.emit("integrate:velocities",{bodies:t,dt:e}),this.integratePositions(t,e),n&&n.emit("integrate:positions",{bodies:t,dt:e}),this},integrateVelocities:function(t,e){throw"The integrator.integrateVelocities() method must be overriden"},integratePositions:function(t,e){throw"The integrator.integratePositions() method must be overriden"}})}(),function(){var t={meta:!1,metaRefresh:200,width:600,height:600};n.renderer=i("renderer",{init:function(i){var r="string"==typeof i.el?e.getElementById(i.el):i.el;this.options=n.util.extend({},t,i),this.el=r||e.body,this.drawMeta=n.util.throttle(n.util.bind(this.drawMeta,this),this.options.metaRefresh)},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},render:function(t,e){var n,i;this.beforeRender&&this.beforeRender(),this._world.emit("beforeRender",{renderer:this,bodies:t,meta:e}),this.options.meta&&this.drawMeta(e);for(var r=0,o=t.length;r<o;++r)n=t[r],i=n.view||(n.view=this.createView(n.geometry,n.styles)),n.hidden||this.drawBody(n,i);return this},createView:function(t){throw"You must override the renderer.createView() method."},drawMeta:function(t){throw"You must override the renderer.drawMeta() method."},drawBody:function(t,e){throw"You must override the renderer.drawBody() method."}})}(),function(){var t=function t(e,n,i){for(var r,o,s=function(){return t(e,n,i)};r=e.shift();)if((o=r.apply(n,i))&&o.then)return o.then(s)},e={timestep:6.25,maxIPF:16,webworker:!1,integrator:"verlet"},i=function t(e,n){if(!(this instanceof t))return new t(e,n);this.init(e,n)};i.prototype=n.util.extend({},n.util.pubsub.prototype,{init:function(i,r){var o=this;(n.util.isFunction(i)||n.util.isArray(i))&&(r=i,i={}),this._stats={fps:0,ipf:0},this._bodies=[],this._behaviors=[],this._integrator=null,this._renderer=null,this._paused=!1,this.options=n.util.options(e),this.options.onChange(function(t){o.timeStep(t.timestep)}),this.options(i),this.add(n.integrator(this.options.integrator)),n.util.isFunction(r)?t([r],this,[this,n]):n.util.isArray(r)&&t(r,this,[this,n])},options:null,add:function(t){var e=0,n=t&&t.length||0,i=n?t[0]:t;if(!i)return this;do{switch(i.type){case"behavior":this.addBehavior(i);break;case"integrator":this.integrator(i);break;case"renderer":this.renderer(i);break;case"body":this.addBody(i);break;default:throw'Error: failed to add item of unknown type "'+i.type+'" to world'}}while(++e<n&&(i=t[e]));return this},remove:function(t){var e=0,n=t&&t.length||0,i=n?t[0]:t;if(!i)return this;do{switch(i.type){case"behavior":this.removeBehavior(i);break;case"integrator":i===this._integrator&&this.integrator(null);break;case"renderer":i===this._renderer&&this.renderer(null);break;case"body":this.removeBody(i);break;default:throw'Error: failed to remove item of unknown type "'+i.type+'" from world'}}while(++e<n&&(i=t[e]));return this},has:function(t){var e;if(!t)return!1;switch(t.type){case"behavior":e=this._behaviors;break;case"integrator":return this._integrator===t;case"renderer":return this._renderer===t;case"body":e=this._bodies;break;default:throw'Error: unknown type "'+t.type+'"'}return n.util.indexOf(e,t)>-1},integrator:function(t){return void 0===t?this._integrator:this._integrator===t?this:(this._integrator&&(this._integrator.setWorld(null),this.emit("remove:integrator",{integrator:this._integrator})),t&&(this._integrator=t,this._integrator.setWorld(this),this.emit("add:integrator",{integrator:this._integrator})),this)},renderer:function(t){return void 0===t?this._renderer:this._renderer===t?this:(this._renderer&&(this._renderer.setWorld(null),this.emit("remove:renderer",{renderer:this._renderer})),t&&(this._renderer=t,this._renderer.setWorld(this),this.emit("add:renderer",{renderer:this._renderer})),this)},timeStep:function(t){return t?(this._dt=t,this._maxJump=t*this.options.maxIPF,this):this._dt},addBehavior:function(t){return this.has(t)?this:(t.setWorld(this),this._behaviors.push(t),this.emit("add:behavior",{behavior:t}),this)},getBehaviors:function(){return[].concat(this._behaviors)},removeBehavior:function(t){var e=this._behaviors;if(t)for(var n=0,i=e.length;n<i;++n)if(t===e[n]){e.splice(n,1),t.setWorld(null),this.emit("remove:behavior",{behavior:t});break}return this},addBody:function(t){return this.has(t)?this:(t.setWorld(this),this._bodies.push(t),this.emit("add:body",{body:t}),this)},getBodies:function(){return[].concat(this._bodies)},removeBody:function(t){var e=this._bodies;if(t)for(var n=0,i=e.length;n<i;++n)if(t===e[n]){e.splice(n,1),t.setWorld(null),this.emit("remove:body",{body:t});break}return this},findOne:function(t){var e=this,i="function"==typeof t?t:n.query(t);return n.util.find(e._bodies,i)||!1},find:function(t){var e=this,i="function"==typeof t?t:n.query(t);return n.util.filter(e._bodies,i)},iterate:function(t){this._integrator.integrate(this._bodies,t)},step:function(t){if(this._paused)return this._time=!1,this;var e=this._time||(this._time=t),n=t-e,i=this._stats,r=this._dt;if(!n)return this;for(n>this._maxJump&&(this._time=t-this._maxJump,n=this._maxJump),i.fps=1e3/n,i.ipf=Math.ceil(n/this._dt);this._time<t;)this._time+=r,this.iterate(r);return this.emit("step"),this},render:function(){if(!this._renderer)throw"No renderer added to world";return this._renderer.render(this._bodies,this._stats),this.emit("render",{bodies:this._bodies,stats:this._stats,renderer:this._renderer}),this},pause:function(){return this._paused=!0,this.emit("pause"),this},unpause:function(){return this._paused=!1,this.emit("unpause"),this},isPaused:function(){return!!this._paused},destroy:function(){var t=this;t.pause(),this.emit("destroy"),t.off(!0),t.remove(t.getBodies()),t.remove(t.getBehaviors()),t.integrator(null),t.renderer(null)}}),n.world=i}(),n.integrator("verlet",function(t){return n.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var n,i=e*e,r=1-this.options.drag,o=null,s=0,a=t.length;s<a;++s)o=t[s],n=o.state,"static"!==o.treatment?(n.vel.equals(n.old.vel)&&o.started()?n.vel.clone(n.pos).vsub(n.old.pos):(n.old.pos.clone(n.pos).vsub(n.vel),n.vel.mult(e)),r&&n.vel.mult(r),n.vel.vadd(n.acc.mult(i)),n.vel.mult(1/e),n.old.vel.clone(n.vel),n.acc.zero(),n.angular.vel===n.old.angular.vel&&o.started()?n.angular.vel=n.angular.pos-n.old.angular.pos:(n.old.angular.pos=n.angular.pos-n.angular.vel,n.angular.vel*=e),n.angular.vel+=n.angular.acc*i,n.angular.vel/=e,n.old.angular.vel=n.angular.vel,n.angular.acc=0,o.started(!0)):(n.vel.zero(),n.acc.zero(),n.angular.vel=0,n.angular.acc=0)},integratePositions:function(t,e){for(var n,i=null,r=0,o=t.length;r<o;++r)i=t[r],n=i.state,"static"!==i.treatment&&(n.vel.mult(e),n.old.pos.clone(n.pos),n.pos.vadd(n.vel),n.vel.mult(1/e),n.old.vel.clone(n.vel),n.angular.vel*=e,n.old.angular.pos=n.angular.pos,n.angular.pos+=n.angular.vel,n.angular.vel/=e,n.old.angular.vel=n.angular.vel)}}}),n.geometry("point",function(t){}),n.geometry("circle",function(t){var e={radius:1};return{init:function(i){t.init.call(this,i),i=n.util.extend({},e,i),this.radius=i.radius,this._aabb=n.aabb()},aabb:function(t){var e=this.radius,n=this._aabb;return n.halfWidth()===e?n.get():n.set(-e,-e,e,e).get()},getFarthestHullPoint:function(t,e){return e=e||n.vector(),e.clone(t).normalize().mult(this.radius)},getFarthestCorePoint:function(t,e,i){return e=e||n.vector(),e.clone(t).normalize().mult(this.radius-i)}}}),n.geometry("convex-polygon",function(t){var e={};return{init:function(i){t.init.call(this,i),i=n.util.extend({},e,i),this.setVertices(i.vertices||[])},setVertices:function(t){var e=n.scratchpad(),i=e.transform(),r=this.vertices=[];if(!n.geometry.isPolygonConvex(t))throw"Error: The vertices specified do not match that of a _convex_ polygon.";i.setRotation(0),i.setTranslation(n.geometry.getPolygonCentroid(t).negate());for(var o=0,s=t.length;o<s;++o)r.push(n.vector(t[o]).translate(i));return this._area=n.geometry.getPolygonArea(r),this._aabb=!1,e.done(),this},aabb:function(t){if(!t&&this._aabb)return this._aabb.get();var e,i=n.scratchpad(),r=i.vector(),o=i.transform().setRotation(t||0),s=i.vector().clone(n.vector.axis[0]).rotateInv(o),a=i.vector().clone(n.vector.axis[1]).rotateInv(o),c=this.getFarthestHullPoint(s,r).proj(s),u=-this.getFarthestHullPoint(s.negate(),r).proj(s),l=this.getFarthestHullPoint(a,r).proj(a),h=-this.getFarthestHullPoint(a.negate(),r).proj(a);return e=new n.aabb(u,h,c,l),t||(this._aabb=e),i.done(),e.get()},getFarthestHullPoint:function(t,e,i){var r,o,s,a=this.vertices,c=a.length,u=2;if(e=e||n.vector(),c<2)return i&&(i.idx=0),e.clone(a[0]);if(o=a[0].dot(t),r=a[1].dot(t),2===c)return s=r>=o?1:0,i&&(i.idx=s),e.clone(a[s]);if(r>=o){for(;u<c&&r>=o;)o=r,r=a[u].dot(t),u++;return r>=o&&u++,s=u-2,i&&(i.idx=u-2),e.clone(a[s])}for(u=c;u>1&&o>=r;)u--,r=o,o=a[u].dot(t);return s=(u+1)%c,i&&(i.idx=s),e.clone(a[s])},getFarthestCorePoint:function(t,e,i){var r,o=n.scratchpad(),s=o.vector(),a=o.vector(),c=this.vertices,u=c.length,l=this._area>0,h={};return e=this.getFarthestHullPoint(t,e,h),s.clone(c[(h.idx+1)%u]).vsub(e).normalize().perp(l),a.clone(c[(h.idx-1+u)%u]).vsub(e).normalize().perp(!l),r=i/(1+s.dot(a)),e.vadd(s.vadd(a).mult(r)),o.done(),e}}}),n.body("circle",function(t){var e={radius:1};return{init:function(i){t.init.call(this,i),i=n.util.extend({},e,i),this.geometry=n.geometry("circle",{radius:i.radius}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=this.mass*this.geometry.radius*this.geometry.radius/2}}}),n.body("convex-polygon",function(t){var e={};return{init:function(i){t.init.call(this,i),i=n.util.extend({},e,i),this.geometry=n.geometry("convex-polygon",{vertices:i.vertices}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=n.geometry.getPolygonMOI(this.geometry.vertices)}}}),n.body("point",function(){}),n.behavior("attractor",function(t){var e={pos:null,strength:1,order:2,max:!1,min:!1};return{init:function(i){var r=this;this._pos=new n.vector,t.init.call(this),this.options.defaults(e),this.options.onChange(function(t){r._maxDist=!1===t.max?1/0:t.max,r._minDist=t.min?t.min:10,r.position(t.pos)}),this.options(i)},position:function(t){var e=this;return t?(this._pos.clone(t),e):this._pos.values()},behave:function(t){for(var e,i,r,o=this.getTargets(),s=this.options.order,a=this.options.strength,c=this._minDist,u=this._maxDist,l=n.scratchpad(),h=l.vector(),d=0,f=o.length;d<f;d++)e=o[d],h.clone(this._pos),h.vsub(e.state.pos),(i=h.norm())>c&&i<u&&(r=a/Math.pow(i,s),e.accelerate(h.normalize().mult(r)));l.done()}}}),n.behavior("body-collision-detection",function(t){var e=function(t,e){var i;return i=function(r){var o,s=n.scratchpad(),a=s.transform().setTranslation(t.state.pos).setRotation(t.state.angular.pos),c=s.transform().setTranslation(e.state.pos).setRotation(e.state.angular.pos),u=s.vector(),l=s.vector(),h=i.useCore?"getFarthestCorePoint":"getFarthestHullPoint",d=i.marginA,f=i.marginB;return u=t.geometry[h](r.rotateInv(a),u,d).transform(a),l=e.geometry[h](r.rotate(a).rotateInv(c).negate(),l,f).transform(c),r.negate().rotate(c),o={a:u.values(),b:l.values(),pt:u.vsub(l).values()},s.done(),o},i.useCore=!1,i.margin=0,i},i=function(t,i){var r,o,s,a=n.scratchpad(),c=a.vector(),u=a.vector(),l=!1,h=t.aabb(),d=Math.min(h.halfWidth,h.halfHeight),f=i.aabb(),p=Math.min(f.halfWidth,f.halfHeight);if(s=e(t,i),c.clone(t.state.pos).vsub(i.state.pos),o=n.gjk(s,c,!0),o.overlap){for(l={bodyA:t,bodyB:i},s.useCore=!0,s.marginA=0,s.marginB=0;o.overlap&&(s.marginA<d||s.marginB<p);)s.marginA<d&&(s.marginA+=1),s.marginB<p&&(s.marginB+=1),o=n.gjk(s,c);if(o.overlap||o.maxIterationsReached)return a.done(),!1;r=Math.max(0,s.marginA+s.marginB-o.distance),l.overlap=r,l.norm=c.clone(o.closest.b).vsub(u.clone(o.closest.a)).normalize().values(),l.mtv=c.mult(r).values(),l.pos=c.clone(l.norm).mult(s.margin).vadd(u.clone(o.closest.a)).vsub(t.state.pos).values()}return a.done(),l},r=function(t,e){var i,r=n.scratchpad(),o=r.vector(),s=(r.vector(),!1);return o.clone(e.state.pos).vsub(t.state.pos),i=o.norm()-(t.geometry.radius+e.geometry.radius),o.equals(n.vector.zero)&&o.set(1,0),i<=0&&(s={bodyA:t,bodyB:e,norm:o.normalize().values(),mtv:o.mult(-i).values(),pos:o.normalize().mult(t.geometry.radius).values(),overlap:-i}),r.done(),s},o=function(t,e){return("static"!==t.treatment&&"kinematic"!==t.treatment||"static"!==e.treatment&&"kinematic"!==e.treatment)&&("circle"===t.geometry.name&&"circle"===e.geometry.name?r(t,e):i(t,e))},s={check:"collisions:candidates",channel:"collisions:detected"};return{init:function(e){t.init.call(this),this.options.defaults(s),this.options(e)},connect:function(t){!0===this.options.check?t.on("integrate:velocities",this.checkAll,this):t.on(this.options.check,this.check,this)},disconnect:function(t){!0===this.options.check?t.off("integrate:velocities",this.checkAll):t.off(this.options.check,this.check)},check:function(t){for(var e,i,r=t.candidates,s=this.getTargets(),a=[],c=0,u=r.length;c<u;++c)e=r[c],(s===this._world._bodies||n.util.indexOf(s,e.bodyA)>-1&&n.util.indexOf(s,e.bodyB)>-1)&&(i=o(e.bodyA,e.bodyB))&&a.push(i);a.length&&this._world.emit(this.options.channel,{collisions:a})},checkAll:function(t){for(var e,n,i,r=this.getTargets(),s=(t.dt,[]),a=0,c=r.length;a<c;a++){e=r[a];for(var u=a+1;u<c;u++)n=r[u],(i=o(e,n))&&s.push(i)}s.length&&this._world.emit(this.options.channel,{collisions:s})}}}),n.behavior("body-impulse-response",function(t){var e={check:"collisions:detected"};return{init:function(n){
t.init.call(this),this.options.defaults(e),this.options(n)},applyTo:!1,connect:function(t){t.on(this.options.check,this.respond,this)},disconnect:function(t){t.off(this.options.check,this.respond)},collideBodies:function(t,e,i,r,o,s){var a="static"===t.treatment||"kinematic"===t.treatment,c="static"===e.treatment||"kinematic"===e.treatment,u=n.scratchpad(),l=u.vector().clone(o);if(a&&c)return void u.done();a?e.state.pos.vadd(l):c?t.state.pos.vsub(l):(l.mult(.5),t.state.pos.vsub(l),e.state.pos.vadd(l));var h,d,f,p=a?0:1/t.moi,v=c?0:1/e.moi,g=a?0:1/t.mass,m=c?0:1/e.mass,y=s?0:t.restitution*e.restitution,b=t.cof*e.cof,_=u.vector().clone(i),w=u.vector().clone(_).perp(),x=u.vector().clone(r),T=u.vector().clone(r).vadd(t.state.pos).vsub(e.state.pos),E=u.vector(),k=t.state.angular.vel,I=e.state.angular.vel,P=u.vector().clone(e.state.vel).vadd(E.clone(T).perp().mult(I)).vsub(t.state.vel).vsub(E.clone(x).perp().mult(k)),A=x.proj(_),S=x.proj(w),C=T.proj(_),M=T.proj(w),B=P.proj(_),D=P.proj(w);if(B>=0)return void u.done();h=-(1+y)*B/(g+m+p*S*S+v*M*M),a?(e.state.vel.vadd(_.mult(h*m)),e.state.angular.vel-=h*v*M):c?(t.state.vel.vsub(_.mult(h*g)),t.state.angular.vel+=h*p*S):(e.state.vel.vadd(_.mult(h*m)),e.state.angular.vel-=h*v*M,t.state.vel.vsub(_.mult(g*e.mass)),t.state.angular.vel+=h*p*S),b&&D&&(f=D/(g+m+p*A*A+v*C*C),d=D<0?-1:1,h*=d*b,h=1===d?Math.min(h,f):Math.max(h,f),a?(e.state.vel.vsub(w.mult(h*m)),e.state.angular.vel-=h*v*C):c?(t.state.vel.vadd(w.mult(h*g)),t.state.angular.vel+=h*p*A):(e.state.vel.vsub(w.mult(h*m)),e.state.angular.vel-=h*v*C,t.state.vel.vadd(w.mult(g*e.mass)),t.state.angular.vel+=h*p*A)),u.done()},respond:function(t){for(var e,i=this,r=n.util.shuffle(t.collisions),o=0,s=r.length;o<s;++o)e=r[o],i.collideBodies(e.bodyA,e.bodyB,e.norm,e.pos,e.mtv)}}}),n.behavior("constant-acceleration",function(t){var e={acc:{x:0,y:4e-4}};return{init:function(i){t.init.call(this),this.options.defaults(e),this.options(i),this._acc=n.vector(),this.setAcceleration(this.options.acc),delete this.options.acc},setAcceleration:function(t){return this._acc.clone(t),this},behave:function(t){for(var e=this.getTargets(),n=0,i=e.length;n<i;++n)e[n].accelerate(this._acc)}}}),n.behavior("edge-collision-detection",function(t){var e=function(t,e,i){var r,o=t.aabb(),s=n.scratchpad(),a=s.transform(),c=s.vector(),u=s.vector(),l=!1,h=[];return r=o.pos.x+o.x-e.max.x,r>=0&&(c.set(1,0).rotateInv(a.setRotation(t.state.angular.pos)),l={bodyA:t,bodyB:i,overlap:r,norm:{x:1,y:0},mtv:{x:r,y:0},pos:t.geometry.getFarthestHullPoint(c,u).rotate(a).values()},h.push(l)),r=o.pos.y+o.y-e.max.y,r>=0&&(c.set(0,1).rotateInv(a.setRotation(t.state.angular.pos)),l={bodyA:t,bodyB:i,overlap:r,norm:{x:0,y:1},mtv:{x:0,y:r},pos:t.geometry.getFarthestHullPoint(c,u).rotate(a).values()},h.push(l)),r=e.min.x-(o.pos.x-o.x),r>=0&&(c.set(-1,0).rotateInv(a.setRotation(t.state.angular.pos)),l={bodyA:t,bodyB:i,overlap:r,norm:{x:-1,y:0},mtv:{x:-r,y:0},pos:t.geometry.getFarthestHullPoint(c,u).rotate(a).values()},h.push(l)),r=e.min.y-(o.pos.y-o.y),r>=0&&(c.set(0,-1).rotateInv(a.setRotation(t.state.angular.pos)),l={bodyA:t,bodyB:i,overlap:r,norm:{x:0,y:-1},mtv:{x:0,y:-r},pos:t.geometry.getFarthestHullPoint(c,u).rotate(a).values()},h.push(l)),s.done(),h},i=function(t,n,i){return e(t,n,i)},r={aabb:null,restitution:.99,cof:1,channel:"collisions:detected"};return{init:function(e){t.init.call(this),this.options.defaults(r),this.options(e),this.setAABB(this.options.aabb),this.restitution=this.options.restitution,this.body=n.body("point",{treatment:"static",restitution:this.options.restitution,cof:this.options.cof})},setAABB:function(t){if(!t)throw"Error: aabb not set";t=t.get&&t.get()||t,this._edges={min:{x:t.pos.x-t.x,y:t.pos.y-t.y},max:{x:t.pos.x+t.x,y:t.pos.y+t.y}}},connect:function(t){t.on("integrate:velocities",this.checkAll,this)},disconnect:function(t){t.off("integrate:velocities",this.checkAll)},checkAll:function(t){for(var e,n,r=this.getTargets(),o=(t.dt,[]),s=this._edges,a=this.body,c=0,u=r.length;c<u;c++)e=r[c],"dynamic"===e.treatment&&(n=i(e,s,a))&&o.push.apply(o,n);o.length&&this._world.emit(this.options.channel,{collisions:o})}}}),n.behavior("interactive",function(t){if(!e)return{};var i={el:null,moveThrottle:10,minVel:{x:-5,y:-5},maxVel:{x:5,y:5}},r=function(t){var e=0,n=0;if(t.offsetParent)do{e+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:n}},o=function(t){var e=r(t.target),n=t.changedTouches&&t.changedTouches[0]||t;return{x:n.pageX-e.left,y:n.pageY-e.top}};return{init:function(r){var s,a,c=this;if(t.init.call(this),this.options.defaults(i),this.options(r),this.mousePos=new n.vector,this.mousePosOld=new n.vector,this.offset=new n.vector,this.el="string"==typeof this.options.el?e.getElementById(this.options.el):this.options.el,!this.el)throw"No DOM element specified";var u=function(t){var e,i=o(t);c._world&&(e=c._world.findOne({$at:new n.vector(i.x,i.y)}),e?(s=e.treatment,e.treatment="kinematic",e.state.vel.zero(),e.state.angular.vel=0,c.body=e,c.mousePos.clone(i),c.offset.clone(i).vsub(e.state.pos),i.body=e,c._world.emit("interact:grab",i)):c._world.emit("interact:poke",i))},l=n.util.throttle(function(t){var e;c.body&&(e=o(t),a=Date.now(),c.mousePosOld.clone(c.mousePos),c.mousePos.set(e.x,e.y))},c.options.moveThrottle),h=function(t){var e=o(t),n=Math.max(Date.now()-a,c.options.moveThrottle);c.mousePos.set(e.x,e.y),c.body&&(c.body.treatment=s,c.body.state.vel.clone(c.mousePos).vsub(c.mousePosOld).mult(1/n),c.body.state.vel.clamp(c.options.minVel,c.options.maxVel),c.body=!1),c._world&&c._world.emit("interact:release",e)};this.el.addEventListener("mousedown",u),this.el.addEventListener("touchstart",u),this.el.addEventListener("mousemove",l),this.el.addEventListener("touchmove",l),this.el.addEventListener("mouseup",h),this.el.addEventListener("touchend",h)},connect:function(t){t.on("integrate:positions",this.behave,this)},disconnect:function(t){t.off("integrate:positions",this.behave)},behave:function(t){var e,n=this;n.body&&(e=n.body.state,e.vel.clone(n.mousePos).vsub(n.offset).vsub(e.pos).mult(1/n.options.moveThrottle))}}}),n.behavior("newtonian",function(t){var e={strength:1,max:!1,min:!1};return{init:function(n){var i=this;t.init.call(this),this.options.defaults(e),this.options.onChange(function(t){i._maxDistSq=!1===t.max?1/0:t.max*t.max,i._minDistSq=t.min?t.min*t.min:100*t.strength}),this.options(n)},behave:function(t){for(var e,i,r,o,s=this.getTargets(),a=this.options.strength,c=this._minDistSq,u=this._maxDistSq,l=n.scratchpad(),h=l.vector(),d=0,f=s.length;d<f;d++){e=s[d];for(var p=d+1;p<f;p++)i=s[p],h.clone(i.state.pos),h.vsub(e.state.pos),(r=h.normSq())>c&&r<u&&(o=a/r,e.accelerate(h.normalize().mult(o*i.mass)),i.accelerate(h.mult(e.mass/i.mass).negate()))}l.done()}}}),n.behavior("sweep-prune",function(t){function e(t,e){return t!==e&&(t>e?t<<16|65535&e:e<<16|65535&t)}var i=1,r=function(){return i++},o={x:0,y:1};return{init:function(e){t.init.call(this),this.options.defaults({channel:"collisions:candidates"}),this.options(e),this.clear()},clear:function(){this.tracked=[],this.pairs=[],this.intervalLists={};for(var t in o)this.intervalLists[t]=[]},connect:function(t){t.on("add:body",this.trackBody,this),t.on("remove:body",this.untrackBody,this),t.on("integrate:velocities",this.sweep,this);for(var e=t.getBodies(),n=0,i=e.length;n<i;++n)this.trackBody({body:e[n]})},disconnect:function(t){t.off("add:body",this.trackBody),t.off("remove:body",this.untrackBody),t.off("integrate:velocities",this.sweep),this.clear()},broadPhase:function(){return this.updateIntervals(),this.sortIntervalLists(),this.checkOverlaps()},sortIntervalLists:function(){var t,e,n,i,r,s,a,c,u;for(var l in o)for(t=this.intervalLists[l],n=0,e=t.length,u=o[l];++n<e;){for(r=t[n],s=r.val.get(u),i=n,a=t[i-1],c=a&&a.val.get(u);i>0&&(c>s||c===s&&a.type&&!r.type);)t[i]=a,i--,a=t[i-1],c=a&&a.val.get(u);t[i]=r}},getPair:function(t,n,i){var r=e(t.id,n.id);if(!1===r)return null;var o=this.pairs[r];if(!o){if(!i)return null;o=this.pairs[r]={bodyA:t.body,bodyB:n.body,flag:0}}return o},checkOverlaps:function(){var t,e,n,i,r,s,a,c,u,l=o.z||o.y||o.x,h=[],d=0,f=[];for(var p in o)for(t="x"===p,r=this.intervalLists[p],a=-1,s=r.length;++a<s;)if(i=r[a],e=i.tracker,i.type)for(c=d;--c>=0;)n=h[c],n===e?(c<d-1?h[c]=h.pop():h.pop(),d--):(u=this.getPair(e,n,t))&&(u.flag=t?0:u.flag+1,u.flag===l&&f.push(u));else d=h.push(e);return f},updateIntervals:function(){for(var t,e,i=n.scratchpad(),r=i.vector(),o=i.vector(),s=this.tracked,a=s.length;--a>=0;)t=s[a],e=t.interval,r.clone(t.body.state.pos),o.clone(t.body.aabb()),e.min.val.clone(r).vsub(o),e.max.val.clone(r).vadd(o);i.done()},trackBody:function(t){var e=t.body,i={id:r(),body:e},s={min:{type:!1,val:n.vector(),tracker:i},max:{type:!0,val:n.vector(),tracker:i}};i.interval=s,this.tracked.push(i);for(var a in o)this.intervalLists[a].push(s.min,s.max)},untrackBody:function(t){for(var e,n,i,r,s=t.body,a=this.tracked,c=0,u=a.length;c<u;++c)if(i=a[c],i.body===s){a.splice(c,1);for(var l in o){r=0,e=this.intervalLists[l];for(var h=0,d=e.length;h<d;++h)if((n=e[h])===i.interval.min||n===i.interval.max){if(e.splice(h,1),h--,u--,r>0)break;r++}}break}},sweep:function(t){var e,n=this;e=n.broadPhase(),e.length&&this._world.emit(this.options.channel,{candidates:e})}}}),n.behavior("verlet-constraints",function(t){var e=2*Math.PI,i={iterations:2};return{init:function(e){t.init.call(this),this.options.defaults(i),this.options(e),this._distanceConstraints=[],this._angleConstraints=[]},connect:function(t){var e=t.integrator();if(e&&e.name.indexOf("verlet")<0)throw'The rigid constraint manager needs a world with a "verlet" compatible integrator.';t.on("integrate:positions",this.resolve,this)},disconnect:function(t){t.off("integrate:positions",this.resolve)},drop:function(){return this._distanceConstraints=[],this._angleConstraints=[],this},distanceConstraint:function(t,e,i,r){var o;return!(!t||!e)&&(o={id:n.util.uniqueId("dis-constraint"),type:"dis",bodyA:t,bodyB:e,stiffness:i||.5,targetLength:r||e.state.pos.dist(t.state.pos)},o.targetLengthSq=o.targetLength*o.targetLength,this._distanceConstraints.push(o),o)},angleConstraint:function(t,e,i,r,o){var s;return!(!t||!e)&&(s={id:n.util.uniqueId("ang-constraint"),type:"ang",bodyA:t,bodyB:e,bodyC:i,stiffness:r||.5,targetAngle:o||e.state.pos.angle2(t.state.pos,i.state.pos)},this._angleConstraints.push(s),s)},remove:function(t){var e,i,r,o,s;if(r=n.util.isObject(t),i=r?t.type:t.substr(0,3),e="ang"===i?this._angleConstraints:this._distanceConstraints,r){for(o=0,s=e.length;o<s;++o)if(e[o]===t)return e.splice(o,1),this}else for(o=0,s=e.length;o<s;++o)if(e[o].id===t)return e.splice(o,1),this;return this},resolveAngleConstraints:function(t){for(var i,r,o,s,a=this._angleConstraints,c=n.scratchpad(),u=c.transform(),l=0,h=a.length;l<h;++l)i=a[l],r=i.bodyB.state.pos.angle2(i.bodyA.state.pos,i.bodyC.state.pos),(o=r-i.targetAngle)&&(o<=-Math.PI?o+=e:o>=Math.PI&&(o-=e),u.setTranslation(i.bodyB.state.pos),o*=-t*i.stiffness,"dynamic"===i.bodyA.treatment&&"dynamic"===i.bodyB.treatment&&"dynamic"===i.bodyC.treatment&&(s=1/(i.bodyA.mass+i.bodyB.mass+i.bodyC.mass)),"dynamic"===i.bodyA.treatment&&(r="dynamic"===i.bodyB.treatment&&"dynamic"===i.bodyC.treatment?o*(i.bodyB.mass+i.bodyC.mass)*s:"dynamic"!==i.bodyB.treatment?o*i.bodyC.mass/(i.bodyC.mass+i.bodyA.mass):o*i.bodyB.mass/(i.bodyB.mass+i.bodyA.mass),u.setRotation(r),i.bodyA.state.pos.translateInv(u),i.bodyA.state.pos.rotate(u),i.bodyA.state.pos.translate(u)),"dynamic"===i.bodyC.treatment&&(r="dynamic"===i.bodyA.treatment&&"dynamic"===i.bodyB.treatment?-o*(i.bodyB.mass+i.bodyA.mass)*s:"dynamic"!==i.bodyB.treatment?-o*i.bodyA.mass/(i.bodyC.mass+i.bodyA.mass):-o*i.bodyB.mass/(i.bodyB.mass+i.bodyC.mass),u.setRotation(r),i.bodyC.state.pos.translateInv(u),i.bodyC.state.pos.rotate(u),i.bodyC.state.pos.translate(u)),"dynamic"===i.bodyB.treatment&&(r="dynamic"===i.bodyA.treatment&&"dynamic"===i.bodyC.treatment?o*(i.bodyA.mass+i.bodyC.mass)*s:"dynamic"!==i.bodyA.treatment?o*i.bodyC.mass/(i.bodyC.mass+i.bodyB.mass):o*i.bodyA.mass/(i.bodyA.mass+i.bodyC.mass),u.setRotation(r).setTranslation(i.bodyA.state.pos),i.bodyB.state.pos.translateInv(u),i.bodyB.state.pos.rotate(u),i.bodyB.state.pos.translate(u),u.setTranslation(i.bodyC.state.pos),i.bodyB.state.pos.translateInv(u),i.bodyB.state.pos.rotateInv(u),i.bodyB.state.pos.translate(u)));c.done()},resolveDistanceConstraints:function(t){for(var e,i,r,o,s=this._distanceConstraints,a=n.scratchpad(),c=a.vector(),u=0,l=s.length;u<l;++u)e=s[u],c.clone(e.bodyB.state.pos).vsub(e.bodyA.state.pos),i=c.normSq()||1e-4*Math.random(),r=t*e.stiffness*(i-e.targetLengthSq)/i,c.mult(r),o="dynamic"!==e.bodyA.treatment||"dynamic"!==e.bodyB.treatment?1:e.bodyB.mass/(e.bodyA.mass+e.bodyB.mass),"dynamic"===e.bodyA.treatment&&("dynamic"===e.bodyB.treatment&&c.mult(o),e.bodyA.state.pos.vadd(c),"dynamic"===e.bodyB.treatment&&c.mult(1/o)),"dynamic"===e.bodyB.treatment&&("dynamic"===e.bodyA.treatment&&c.mult(1-o),e.bodyB.state.pos.vsub(c));a.done()},shuffleConstraints:function(){this._distanceConstraints=n.util.shuffle(this._distanceConstraints),this._angleConstraints=n.util.shuffle(this._angleConstraints)},resolve:function(){for(var t=this.options.iterations,e=1/t,n=0;n<t;n++)this.resolveDistanceConstraints(e),this.resolveAngleConstraints(e)},getConstraints:function(){return{distanceConstraints:[].concat(this._distanceConstraints),angleConstraints:[].concat(this._angleConstraints)}}}}),n.integrator("improved-euler",function(t){return{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var n,i=1-this.options.drag,r=null,o=0,s=t.length;o<s;++o)r=t[o],n=r.state,"static"!==r.treatment?(n.old.vel.clone(n.vel),n.old.acc.clone(n.acc),n.vel.vadd(n.acc.mult(e)),i&&n.vel.mult(i),n.acc.zero(),n.old.angular.vel=n.angular.vel,n.angular.vel+=n.angular.acc*e,n.angular.acc=0):(n.vel.zero(),n.acc.zero(),n.angular.vel=0,n.angular.acc=0)},integratePositions:function(t,e){for(var i,r=.5*e*e,o=null,s=n.scratchpad(),a=s.vector(),c=0,u=t.length;c<u;++c)o=t[c],i=o.state,"static"!==o.treatment&&(i.old.pos.clone(i.pos),a.clone(i.old.vel),i.pos.vadd(a.mult(e)).vadd(i.old.acc.mult(r)),i.old.acc.zero(),i.old.angular.pos=i.angular.pos,i.angular.pos+=i.old.angular.vel*e+i.old.angular.acc*r,i.old.angular.acc=0);s.done()}}}),n.renderer("canvas",function(t){if(!e)return{};var i=2*Math.PI,r=function(t,n){var i=e.createElement(t||"div");return n&&(i.innerHTML=n),i},o={debug:!1,metaEl:null,styles:{point:"rgba(80, 50, 100, 0.7)",circle:{strokeStyle:"rgba(70, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(44, 105, 44, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"},"convex-polygon":{strokeStyle:"rgba(80, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(114, 105, 124, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"}},offset:{x:0,y:0}},s=function(t,e){return n.util.isPlainObject(e)?n.util.extend({},t,e,s):void 0!==e?e:t};return{init:function(i){if(t.init.call(this,i),this.options=n.util.extend({},o,this.options,s),this.options.offset=n.vector(this.options.offset),this.hiddenCanvas=e.createElement("canvas"),this.hiddenCanvas.width=this.hiddenCanvas.height=100,!this.hiddenCanvas.getContext)throw"Canvas not supported";this.hiddenCtx=this.hiddenCanvas.getContext("2d");var a=this.el;if("CANVAS"!==a.nodeName.toUpperCase()&&(a=e.createElement("canvas"),this.el.appendChild(a),"string"==typeof this.options.el&&this.el===e.body&&(a.id=this.options.el),this.el=a),a.width=this.options.width,a.height=this.options.height,this.ctx=a.getContext("2d"),this.els={},this.options.meta){var c=this.options.metaEl||r();c.className="pjs-meta",this.els.fps=r("span"),this.els.ipf=r("span"),c.appendChild(r("span","fps: ")),c.appendChild(this.els.fps),c.appendChild(r("br")),c.appendChild(r("span","ipf: ")),c.appendChild(this.els.ipf),a.parentNode.insertBefore(c,a)}},setStyle:function(t,e){e=e||this.ctx,n.util.isObject(t)?(e.lineWidth=t.lineWidth,e.strokeStyle=t.lineWidth?t.strokeStyle:"rgba(0,0,0,0)",e.fillStyle=t.fillStyle):(e.fillStyle=e.strokeStyle=t,e.lineWidth=1)},drawCircle:function(t,e,n,r,o){o=o||this.ctx,o.beginPath(),this.setStyle(r,o),o.arc(t,e,n,0,i,!1),o.closePath(),o.stroke(),o.fill()},drawPolygon:function(t,e,n){var i=t[0],r=void 0===i.x?i.get(0):i.x,o=void 0===i.y?i.get(1):i.y,s=t.length;n=n||this.ctx,n.beginPath(),this.setStyle(e,n),n.moveTo(r,o);for(var a=1;a<s;++a)i=t[a],r=void 0===i.x?i.get(0):i.x,o=void 0===i.y?i.get(1):i.y,n.lineTo(r,o);s>2&&n.closePath(),n.stroke(),n.fill()},drawRect:function(t,e,n,i,r,o){var s=.5*n,a=.5*i;o=o||this.ctx,this.setStyle(r,o),o.beginPath(),o.rect(t-s,e-a,n,i),o.closePath(),o.stroke(),o.fill()},drawLine:function(t,e,n,i){var r=void 0===t.x?t.get(0):t.x,o=void 0===t.y?t.get(1):t.y;i=i||this.ctx,i.beginPath(),this.setStyle(n,i),i.moveTo(r,o),r=void 0===e.x?e.get(0):e.x,o=void 0===e.y?e.get(1):e.y,i.lineTo(r,o),i.stroke(),i.fill()},createView:function(t,e){var n,i=t.aabb(),r=i.halfWidth+Math.abs(i.pos.x),o=i.halfHeight+Math.abs(i.pos.y),s=r+1,a=o+1,c=this.hiddenCtx,u=this.hiddenCanvas,l=t.name;return e=e||this.options.styles[l],e.src?(n=new Image,n.src=e.src,e.width&&(n.width=e.width),e.height&&(n.height=e.height),n):(s+=0|e.lineWidth,a+=0|e.lineWidth,u.width=2*r+2+(2*e.lineWidth|0),u.height=2*o+2+(2*e.lineWidth|0),c.save(),c.translate(s,a),"circle"===l?this.drawCircle(0,0,t.radius,e,c):"convex-polygon"===l&&this.drawPolygon(t.vertices,e,c),e.angleIndicator&&(c.beginPath(),this.setStyle(e.angleIndicator,c),c.moveTo(0,0),c.lineTo(r,0),c.closePath(),c.stroke()),c.restore(),n=new Image(u.width,u.height),n.src=u.toDataURL("image/png"),n)},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},beforeRender:function(){this.ctx.clearRect(0,0,this.el.width,this.el.height)},drawBody:function(t,e,n,i){var r=t.state.pos,o=t.aabb();i=i||this.options.offset,n=n||this.ctx,n.save(),n.translate(r.get(0)+i.get(0),r.get(1)+i.get(1)),n.rotate(t.state.angular.pos),n.drawImage(e,-e.width/2,-e.height/2),n.restore(),this.options.debug&&(this.drawRect(o.pos.x,o.pos.y,2*o.x,2*o.y,"rgba(0, 0, 255, 0.3)"),t._debugView=t._debugView||this.createView(t.geometry,"rgba(255, 0, 0, 0.5)"),n.save(),n.translate(r.get(0)+i.get(0),r.get(1)+i.get(1)),n.rotate(t.state.angular.pos),n.drawImage(t._debugView,.5*-t._debugView.width,.5*-t._debugView.height),n.restore())}}}),n.renderer("dom",function(t){if(!e)return{};var n,i={},r=e.createElement("div"),o=function(t){return t.replace(/(?:^|\s)\w/g,function(t){return t.toUpperCase()})},s="px",a=function(t){if(i[t])return i[t];for(var e,n=["Webkit","Moz","Ms","O"],s=0,a=n.length;s<a;++s)if((e=n[s]+o(t))in r.style)return i[t]=e;return e in r.style&&(i[t]=t)}("transform"),c=function(t,n){var i=e.createElement(t||"div");return n&&(i.innerHTML=n),i};return n=a?function(t,e){var n=t.state.pos;e.style[a]="translate("+n.get(0)+"px,"+n.get(1)+"px) rotate("+t.state.angular.pos+"rad)"}:function(t,e){var n=t.state.pos;e.style.left=n.get(0)+s,e.style.top=n.get(1)+s},{init:function(e){t.init.call(this,e);var n=this.el;if(n.style.position="relative",n.style.overflow="hidden",n.style[a]="translateZ(0)",n.style.width=this.options.width+s,n.style.height=this.options.height+s,this.els={},e.meta){var i=c();i.className="pjs-meta",this.els.fps=c("span"),this.els.ipf=c("span"),i.appendChild(c("span","fps: ")),i.appendChild(this.els.fps),i.appendChild(c("br")),i.appendChild(c("span","ipf: ")),i.appendChild(this.els.ipf),n.appendChild(i)}},circleProperties:function(t,e){var n=e.aabb();t.style.width=2*n.halfWidth+s,t.style.height=2*n.halfHeight+s,t.style.marginLeft=-n.halfWidth+s,t.style.marginTop=-n.halfHeight+s},createView:function(t){var e=c(),n=t.name+"Properties";return e.className="pjs-"+t.name,e.style.position="absolute",e.style.top="0px",e.style.left="0px",this[n]&&this[n](e,t),this.el.appendChild(e),e},connect:function(t){t.on("add:body",this.attach,this),t.on("remove:body",this.detach,this)},disconnect:function(t){t.off("add:body",this.attach),t.off("remove:body",this.detach)},detach:function(t){var e=t.nodeType&&t||t.body&&t.body.view,n=e&&e.parentNode;return e&&n&&n.removeChild(e),this},attach:function(t){var e=t.nodeType&&t||t.body&&t.body.view;return e&&this.el.appendChild(e),this},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},drawBody:n}}),n.renderer("pixi",function(t){if(!e)return{};var i=(Math.PI,{debug:!1,metaEl:null,offset:{x:0,y:0},styles:{color:6750105,point:"0xE8900C",circle:{strokeStyle:"0xE8900C",lineWidth:3,fillStyle:"0xD5DE4C",angleIndicator:"0xE8900C"},"convex-polygon":{strokeStyle:"0xE8900C",lineWidth:3,fillStyle:"0xD5DE4C",angleIndicator:"0xE8900C"}}}),r=function(t,e){return n.util.isPlainObject(e)?n.util.extend({},t,e,r):void 0!==e?e:t};return{init:function(o){if("undefined"==typeof PIXI)throw"PIXI obj not present - cannot continue ";t.init.call(this,o),this.options=n.util.extend({},i,this.options,r),this.options.offset=n.vector(this.options.offset),this.stage=new PIXI.Stage(this.options.styles.color),this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height),this.meta={},"CANVAS"==this.el.nodeName?this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height,this.el):(this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height),null!==this.el?this.el.appendChild(this.renderer.view):e.body.appendChild(this.renderer.view))},loadSpritesheets:function(t,e){if(!t instanceof Array)throw"Spritesheets must be defined in arrays";var n=new PIXI.AssetLoader(t);n.load();var i=this;n.on("onComplete",function(t){i.assetsLoaded=!0,e()})},drawBody:function(t){if(null!==t.view){var e=t.view,n=t.state.pos.get(0),i=t.state.pos.get(1),r=t.state.angular.pos;e.position.x=n,e.position.y=i,e.rotation=r,this.renderer.render(this.stage)}},createCircle:function(t,e,n,i){var r=new PIXI.Graphics;return r.beginFill(i.fillStyle),r.lineStyle(i.lineWidth,i.strokeStyle),r.drawCircle(t,e,n),r.pivot.x=t/2+n/2,r.pivot.y=e/2+n/2,r},createPolygon:function(t,e){var n=t[0],i=void 0===n.x?n.get(0):n.x,r=void 0===n.y?n.get(1):n.y,o=t.length,s={x:i,y:r},a=new PIXI.Graphics;a.beginFill(e.fillStyle),a.lineStyle(e.lineWidth,e.strokeStyle),a.moveTo(i,r);for(var c=1;c<o;++c)n=t[c],i=void 0===n.x?n.get(0):n.x,r=void 0===n.y?n.get(1):n.y,a.lineTo(i,r);return o>2&&a.lineTo(s.x,s.y),a.endFill(),a},createLine:function(t,e,n){var i=void 0===t.x?t.get(0):t.x,r=void 0===t.y?t.get(1):t.y,o=new PIXI.Graphics;return o.beginFill(n.fillStyle),o.lineStyle(n.lineWidth,n.strokeStyle),o.moveTo(i,r),i=void 0===e.x?e.get(0):e.x,r=void 0===e.y?e.get(1):e.y,o.lineTo(i,r),o.endFill(),o},createView:function(t){var e=null,n=t.aabb(),i=n.halfWidth+Math.abs(n.pos.x),r=n.halfHeight+Math.abs(n.pos.y),o=i+1,s=r+1,a=t.name,c=c||this.options.styles[a];if(o+=0|c.lineWidth,s+=0|c.lineWidth,"circle"===a?e=this.createCircle(o,s,t.radius,c):"convex-polygon"===a&&(e=this.createPolygon(t.vertices,c)),c.angleIndicator&&(e.beginFill(c.angleIndicator),e.moveTo(o/2,5+c.lineWidth),e.lineTo(o/2+t.radius/2,t.radius),e.endFill()),e)return this.stage.addChild(e),e;throw"Invalid view name passed."},drawMeta:function(t){if(this.meta.loaded)this.meta.fps.setText("FPS: "+t.fps.toFixed(2)),this.meta.ipf.setText("IPF: "+t.ipf);else{var e={font:"18px Snippet",fill:"white",align:"left"};this.meta.fps=new PIXI.Text("FPS: "+t.fps.toFixed(2),e),this.meta.fps.position.x=15,this.meta.fps.position.y=5,this.meta.ipf=new PIXI.Text("IPF: "+t.ipf,e),this.meta.ipf.position.x=15,this.meta.ipf.position.y=30,this.stage.addChild(this.meta.fps),this.stage.addChild(this.meta.ipf),this.meta.loaded=!0}},beforeRender:function(){},createDisplay:function(t,e){var n=null,i=null;switch(t){case"sprite":return i=PIXI.Texture.fromImage(e.texture),n=new PIXI.Sprite(i),e.anchor&&(n.anchor.x=e.anchor.x,n.anchor.y=e.anchor.y),e.container?e.container.addChild(n):this.stage.addChild(n),n;case"movieclip":if(!this.assetsLoaded)throw"No assets have been loaded. Use loadSpritesheet() first";var r=[],o=0;for(o;o<e.frames.length;o++)i=PIXI.Texture.fromFrame(e.frames[o]),r.push(i);return n=new PIXI.MovieClip(r),e.anchor&&(n.anchor.x=e.anchor.x,n.anchor.y=e.anchor.y),e.container?e.container.addChild(n):this.stage.addChild(n),n;default:throw"Invalid PIXI.DisplayObject passed"}},centerAnchor:function(t){null!==t&&(t.anchor.x=.5,t.anchor.y=.5)}}}),n}),define("modules/sprite",[],function(){function t(t,e){this._frames=[],this._offset={x:0,y:0},this._index=0,this._past=0;for(var n=0,i=t.length;n<i;++n)this.addImage(t[n]);this.fps(e||60)}return t.prototype={addImage:function(t){var e=t;"string"==typeof t&&(e=new Image,e.src=t),this._len=this._frames.push(e)},drawTo:function(t,e,n,i,r){var o=this._frames[this.nextFrame()];e|=0,n|=0,i=+i,t.save(),t.translate(e+this._offset.x,n+this._offset.y),r&&t.scale(-1,1),t.rotate(i),t.drawImage(o,.5*-o.width,.5*-o.height),t.restore()},nextFrame:function(){var t=this._index,e=Date.now();return e-this._past>this._mspf&&(t++,t>=this._len&&(t=0),this._index=t,this._past=e),t},offset:function(t){return void 0===t?this._offset:(this._offset.x=0|t.x,this._offset.y=0|t.y,this)},fps:function(t){return void 0===t?this._fps:(this._fps=0|t,this._mspf=1e3/t|0,this)}},t}),define("modules/multicanvas-renderer",["physicsjs"],function(t){t.renderer("multicanvas","canvas",function(e){return{init:function(t){e.init.call(this,t),this.layers={},this.addLayer("main",this.el),this.resize(this.options.width,this.options.height)},addLayer:function(e,n,i){var r=this,o=[],s=t.util.extend({},this.options.styles),a={id:e,el:n||document.createElement("canvas"),options:t.util.options({width:this.el.width,height:this.el.height,manual:!1,autoResize:!0,follow:null,scale:1})(i)};if(e in this.layers)throw'Layer "'+e+'" already added.';return this.el.parentNode.appendChild(a.el),a.el.className+=" physics-layer-"+a.id,a.ctx=a.el.getContext("2d"),a.ctx.scale(1,1),a.el.width=a.options.width,a.el.height=a.options.height,a.reset=function(t){o=t||[]},a.addToStack=function(e){return t.util.isArray(e)?o.push.apply(o,e):o.push(e),a},a.removeFromStack=function(e){var n,i;if(t.util.isArray(e))for(n=0,i=e.length;n<i;++n)a.removeFromStack(e[n]);else(n=t.util.indexOf(o,e))>-1&&o.splice(n,1);return a},a.render=function(e){var n,i=t.scratchpad(),c=i.vector().set(0,0),u=a.options.scale;if(a.options.manual)return i.done(),a;a.options.offset&&("center"===a.options.offset?c.add(.5*a.el.width,.5*a.el.height).mult(1/u):c.vadd(a.options.offset).mult(1/u)),a.options.follow&&c.vsub(a.options.follow.state.pos),!1!==e&&a.ctx.clearRect(0,0,a.el.width,a.el.height),a.ctx.save(),a.ctx.scale(u,u);for(var l=0,h=o.length;l<h;++l)n=o[l],n.hidden||(n.view||(n.view=r.createView(n.geometry,n.styles||s[n.geometry.name])),r.drawBody(n,n.view,a.ctx,c));return a.ctx.restore(),i.done(),a},this.layers[e]=a,a},resize:function(t,e){var n;for(var i in this.layers)n=this.layers[i],n.options.autoResize&&(n.el.width=t,n.el.height=e)},render:function(t,e){this._world.emit("beforeRender",{renderer:this,meta:e}),this.options.meta&&this.drawMeta(e);for(var n in this.layers)this.layers[n].render();return this}}})}),define("mediators/boilerplate",["require","when","plugins/domready","moddef","hammer","physicsjs","modules/sprite","modules/multicanvas-renderer"],function(t,e,n,i,r,o,s,a){"use strict";function c(t){return t>=0?1:-1}function u(t,e,n){var i=t.className.split(" "),r=i.indexOf(e);return n===r>-1?n:r>-1?(i.splice(r,1),t.className=i.join(" "),!1):(t.className+=" "+e,!0)}function l(t,e,n,i,r){var o,s=0,a=0,c=.5*e,u=.5*n;for(t.beginPath(),s=0,o=e;s<o;s+=i)t.moveTo(c+s,0),t.lineTo(c+s,n),t.moveTo(c-s,0),t.lineTo(c-s,n);for(a=0,o=n;a<o;a+=r)t.moveTo(0,u+a),t.lineTo(e,u+a),t.moveTo(0,u-a),t.lineTo(e,u-a);t.closePath(),t.stroke()}var h=function(t){var e=0,n=0;if(t.offsetParent)do{e+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:n}},d=function(t,e){var n=h(e||t.target),i=t.changedTouches&&t.changedTouches[0]||t;return{x:i.pageX-n.left,y:i.pageY-n.top}};return new(i({constructor:function(){var t=this;t.scale=window.innerWidth>1080?.85:Math.min(window.innerWidth/1080,.85),t.minScale=.05,t.maxScale=1,t.waterTog=!0,t.grid=!1,t.initEvents(),n(function(){t.onDomReady(),t.resolve("domready")})},initEvents:function(){function t(){e.scale=Math.max(e.minScale,Math.min(e.maxScale,e.scale)),e.emit("scale",e.scale)}var e=this;e.after("domready",function(){function n(){h.x=l.right-l.left,h.y=l.down-l.up,e.emit("thrust",h)}var i,s=document.getElementById("viewport");s.tabIndex=0,s.focus();var a=r(s);a.on("mousewheel",function(n){var i=Math.min(Math.abs(n.wheelDelta)/50,.2)*c(n.wheelDelta);e.scale*=Math.pow(2,i),t(),n.preventDefault()}),a.on("transformstart",function(t){i=e.scale,t.preventDefault()}),a.on("transform",function(n){e.scale=i*n.gesture.scale,t(),n.preventDefault()}),a.on("touch",function(t){t.preventDefault(),e.emit("touch",t)}),a.on("touchstart",function(t){s.focus(),t.preventDefault()}),a.on("drag",function(t){t.preventDefault(),e.emit("drag",t)}),a.on("release",function(t){t.preventDefault(),e.emit("release",t)});var l={up:0,down:0,left:0,right:0},h={x:0,y:0},f=document.getElementById("ctrl-booster");r(document.getElementById("controls")).on("touch",function(n){n.preventDefault(),"ctrl-brakes"===n.target.id?e.emit("brakes"):"ctrl-grab-mode"===n.target.id?e.grabMode=u(n.target,"on"):"ctrl-zoom-in"===n.target.id?(e.scale*=2,t()):"ctrl-zoom-out"===n.target.id?(e.scale*=.5,t()):"ctrl-sheep"===n.target.id?e.emit("sheep-toggle",u(n.target,"on")):"ctrl-water"===n.target.id?e.waterTog=u(n.target,"on"):"ctrl-booster"===n.target.id&&(e.booster=u(n.target,"on"),e.emit("thrust",h))}),s.addEventListener("keydown",function(t){switch(t.keyCode){case 38:case 87:l.up=100,n();break;case 40:case 83:l.down=100,n();break;case 37:case 65:l.left=100,n();break;case 39:case 68:l.right=100,n();break;case 32:e.booster=!0,u(f,"on",!0),n()}return!1}),s.addEventListener("keyup",function(t){switch(t.keyCode){case 38:case 87:l.up=0,n();break;case 40:case 83:l.down=0,n();break;case 37:case 65:l.left=0,n();break;case 39:case 68:l.right=0,n();break;case 32:e.booster=!1,u(f,"on",!1),n()}return!1}),window.addEventListener("resize",function(){e.viewWidth=window.innerWidth,e.viewHeight=window.innerHeight,e.emit("resize")},!0);var p=document.getElementById("joystick"),v=r(p),g=.5*p.height,m=.5*p.width;v.on("touch drag",o.util.throttle(function(t){var n=d(t.gesture.center,t.target);h.x=n.x-m,h.y=n.y-g,e.emit("thrust",h)}),50),v.on("release",function(t){h.x=h.y=0,e.emit("thrust",h)}),e.on("touch",function(t){e.emit("dismiss-instructions"),e.off(t.topic,t.handler)}),e.on("thrust",function(t){e.emit("dismiss-instructions"),e.off(t.topic,t.handler)}),r(document.getElementById("ctrl-grid")).on("touch",function(t){e.grid=u(t.target,"on")})})},initPhysics:function(e){var n,i,r=this,s=o.renderer("multicanvas",{el:"physics",width:r.viewWidth,height:r.viewHeight,styles:{circle:{strokeStyle:"#1a1a1a",lineWidth:0,fillStyle:"#1a1a1a",angleIndicator:"rgba(0,0,0,0)"}}});this.world=e,this.renderer=s,e.add(s),e.on("step",function(){e.render()}),r.on("resize",function(){s.resize(r.viewWidth,r.viewHeight)}),o.util.ticker.on(function(t,n){e.step(t)}),o.util.ticker.start();var a=[];for(n=0,i=5;n<i;++n)a.push(o.body("circle",{x:Math.random()*r.viewWidth,y:Math.random()*r.viewHeight,vx:.1*Math.random(),vy:.1*Math.random(),radius:12,classed:"sheep",styles:{src:t.toUrl("../../images/Sheep.png")}}));r.on("sheep-toggle",function(t,e){for(n=0,i=a.length;n<i;++n)a[n].hidden=!e}),e.add([o.behavior("body-collision-detection").applyTo(a),o.behavior("sweep-prune"),o.behavior("body-impulse-response")]);var c=r.addRocket(0,0),u=s.layers.main.render;s.layers.main.addToStack(a).options({scale:r.scale,offset:"center"}),s.layers.main.render=function(){var t=s.layers.main,e=t.ctx,n=o.scratchpad(),i=n.vector().set(0,0),a=t.el.width,h=t.el.height,d=t.options.scale,f=c.edge.body.state.pos;"center"===t.options.offset?i.add(.5*a,.5*h).mult(1/d):i.vadd(t.options.offset).mult(1/d),
t.options.follow&&i.vsub(t.options.follow.state.pos),e.clearRect(0,0,a,h),e.save(),e.scale(d,d),c.drawBgTo(f.get(0)+i.get(0),f.get(1)+i.get(1),e,s),e.restore(),u(!1),e.save(),e.scale(d,d),c.drawTo(f.get(0)+i.get(0),f.get(1)+i.get(1),e,s),r.grid&&(e.strokeStyle="rgba(100,100,100, 0.4)",e.strokeWidth=.5,l(e,a/d,h/d,20,20)),e.restore(),n.done()};var h=!1,d=o.vector(),f=o.vector(),p=o.vector();r.on("touch",function(t,e){var n=e.gesture.center;n.x=n.pageX,n.y=n.pageY,d.clone(n).sub(r.viewWidth/2,r.viewHeight/2).mult(1/r.scale),c.outerAABB.contains(d)&&(h=!0,d.clone(c.pos),f.clone(d))}),r.on("thrust",function(t,e){p.clone(e).normalize(),r.booster&&p.add(0,-4),c.thrust.clone(e),c.booster=r.booster}),r.on("drag",o.util.throttle(function(t,e){h&&f.clone(d).add(e.gesture.deltaX/r.scale,e.gesture.deltaY/r.scale)},16)),r.on("release",function(t,e){h=!1,c.thrust.zero(),r.emit("thrust",c.thrust)}),r.on("scale",function(t,e){s.layers.main.options({scale:e})}),r.on("brakes",function(){c.edge.body.state.vel.zero()}),e.on("integrate:positions",function(t){c.moveTo(c.pos),h?r.grabMode?c.edge.body.state.vel.clone(f).vsub(c.pos).mult(1/16):(c.edge.body.state.acc.clone(f).vsub(c.edge.body.state.pos).normalize().mult(1e-4),r.emit("thrust",c.edge.body.state.acc)):p.equals(o.vector.zero)||c.edge.body.state.acc.clone(p).mult(1e-4)}),c.edge.body.treatment="kinematic",e.add([c.edge.body,c.constr]),c.edge.applyTo(a),e.add(a),e.add(c.edge);var v=s.addLayer("rocket-cam",null,{width:400,height:400,autoResize:!1,follow:c.edge.body,scale:.8,offset:o.vector(200,210)}),g=v.render;v.render=function(){var t=v.ctx,e=(c.aabb,v.options.offset),n=v.options.scale;t.clearRect(0,0,v.el.width,v.el.height),t.save(),t.scale(n,n),c.drawBgTo(e.get(0)/n,e.get(1)/n,t,s),t.restore(),g(!1),t.save(),t.scale(n,n),c.drawTo(e.get(0)/n,e.get(1)/n,t,s),t.restore(),r.grid&&(t.strokeStyle="rgba(100,100,100, 0.4)",t.strokeWidth=.5,l(t,v.el.width,v.el.height,20,20))},v.addToStack(a);var m=[],y=0,b=[],_=o.util.throttle(function(){if(r.waterTog){var t=o.body("circle",{tag:"water",x:-45,y:0,vx:.09,radius:3,view:b[y]});t.state.pos.vadd(c.edge.body.state.pos),t.state.vel.vadd(c.edge.body.state.vel),m.push(t),e.add(t),s.layers.main.addToStack(t),v.addToStack(t),c.edge.applyTo(m.concat(a)),y=y>1?0:y+1}},250);for(n=0,i=3;n<i;++n)b[n]=new Image,b[n].src=t.toUrl("../../images/Water-1.png");e.on("step",_),e.on("collisions:detected",function(t){for(var n,i,r=0,u=t.collisions.length;r<u;++r)n=t.collisions[r],("water"===n.bodyA.tag&&n.bodyB===c.edge.body||"water"===n.bodyB.tag&&n.bodyA===c.edge.body)&&(i="water"===n.bodyA.tag?n.bodyA:n.bodyB,e.remove(i),m.splice(o.util.indexOf(m,i),1),c.edge.applyTo(m.concat(a)),s.layers.main.removeFromStack(i),v.removeFromStack(i))});var w=document.getElementById("speed-meter"),x=o.util.throttle(function(){var t=1e3*c.edge.body.state.vel.norm();w.innerHTML=t.toFixed(1)+" px/s"},200),T={},E=c.outerAABB.halfWidth(),k=c.outerAABB.halfHeight();e.on("step",function(){if(!h){var t,e,n,i=.5/r.scale,s=c.pos.get(0),a=c.pos.get(1),u=o.scratchpad(),l=u.vector().set(0,0);if(T.maxX=r.viewWidth*i+E,T.minX=-T.maxX,T.maxY=r.viewHeight*i+k,T.minY=-T.maxY,s<=T.minX?l.add(T.maxX-T.minX,0):s>T.maxX&&l.sub(T.maxX-T.minX,0),a<=T.minY?l.add(0,T.maxY-T.minY):a>T.maxY&&l.sub(0,T.maxY-T.minY),!l.equals(o.vector.zero))for(c.pos.vadd(l),c.edge.body.state.old.pos.vadd(l),c.moveTo(c.pos),n=c.edge.getTargets(),t=0,e=n.length;t<e;++t)n[t].state.pos.vadd(l),n[t].state.old.pos.vadd(l);u.done()}}),e.on("step",x)},addRocket:function(e,n){var i=o.aabb({pos:{x:e,y:n},halfWidth:50,halfHeight:100}),r=o.behavior("edge-collision-detection",{aabb:i,restitution:.4,cof:.8}).applyTo([]),a=o.aabb(0,0,243,549),c=new Image,u=new Image,l=new s([t.toUrl("../../images/Fire-1.png"),t.toUrl("../../images/Fire-2.png"),t.toUrl("../../images/Fire-3.png")]).offset({x:-5,y:3}).fps(20),h=new s([t.toUrl("../../images/Small-Fire-1.png"),t.toUrl("../../images/Small-Fire-2.png"),t.toUrl("../../images/Small-Fire-3.png")]).fps(20),d=.5*Math.PI;c.src=t.toUrl("../../images/Rocket.png"),u.src=t.toUrl("../../images/Rocket-bg.png");var f={aabb:i,thrust:o.vector(),booster:!1,outerAABB:a,edge:r,pos:r.body.state.pos,moveTo:function(t){return f.pos.clone(t),f.aabb._pos.clone(t),f.outerAABB._pos.clone(t).add(0,90),f.edge.setAABB(f.aabb),f},drawTo:function(t,e,n,i){n.save(),n.translate(t,e+90),f.thrust.get(1)>0?(h.drawTo(n,-45,-311,-d),h.drawTo(n,46,-311,-d,!0)):f.thrust.get(1)<0&&(h.drawTo(n,-40,147,d,!0),h.drawTo(n,42,148,d)),f.thrust.get(0)>0?h.drawTo(n,-130,-89,0,!0):f.thrust.get(0)<0&&h.drawTo(n,130,-89,0),n.drawImage(c,-c.width/2,-c.height/2),f.booster&&l.drawTo(n),n.restore()},drawBgTo:function(t,e,n,i){n.save(),n.translate(t,e+90),n.drawImage(u,-u.width/2,-u.height/2),n.restore()}};return f.moveTo({x:e,y:n}),f},initJoystick:function(n){function i(t,e){var n=t.norm();return 0===n?t:t.mult(Math.min(e,n)/n)}function r(t,e){l.clone(e),i(l,.5*c-49),l.add(.5*c,.5*u),a.clearRect(0,0,c,u),a.drawImage(d,-1,-1),a.save(),a.translate(l.get(0),l.get(1)),a.drawImage(h,.5*-h.width,.5*-h.height),a.restore()}var s=this,a=n.getContext("2d"),c=n.width,u=n.height,l=o.vector(),h=new Image,d=new Image;e.map([h,d],function(t){var n=e.defer();return t.onload=n.resolve,n.promise}).then(function(){s.on("thrust",r),r(null,l)}),h.src=t.toUrl("../../images/Joystick.png"),d.src=t.toUrl("../../images/Joystick-bg.png")},onDomReady:function(){var t=this;t.viewWidth=window.innerWidth,t.viewHeight=window.innerHeight,o(t.initPhysics.bind(t)),t.initJoystick(document.getElementById("joystick"));var e=document.getElementById("instructions");e.style.opacity="1",t.on("dismiss-instructions",function(){e.style.opacity="0",setTimeout(function(){e=document.getElementById("direction"),e.style.opacity="1",setTimeout(function(){e.style.opacity="0"},3e4)},15e3)})}},["events"]))}),require(["config/require-config"],function(){require(["mediators/boilerplate"])}),define("page-boilerplate",function(){}),define("page-boilerplate",function(){});